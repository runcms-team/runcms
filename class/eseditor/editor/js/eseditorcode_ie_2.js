/**
*
* @ Copyright: Copyright (C) Farsus Design. All rights reserved. 
* @ Package: ScarPoX / shortterm SPX
* @ Subpackage: RUNCMS 
* @ License: http://www.gnu.org/copyleft/gpl.html GNU/GPL
* @ Subpackage: ScarPoX ESeditor
* @ ESeditor is based on FCKeditor by Frederico Caldeira Knabben
* @ original authers website http://www.fckeditor.net
*
*/

ES.RedirectNamedCommands=new Object();ES.ExecuteNamedCommand=function(A,B,C){ESUndo.SaveUndoStep();if (!C&&ES.RedirectNamedCommands[A]!=null) ES.ExecuteRedirectedNamedCommand(A,B);else{ES.Focus();ES.EditorDocument.execCommand(A,false,B);ES.Events.FireEvent('OnSelectionChange');};ESUndo.SaveUndoStep();};ES.GetNamedCommandState=function(A){try{if (!ES.EditorDocument.queryCommandEnabled(A)) return ES_TRISTATE_DISABLED;else return ES.EditorDocument.queryCommandState(A)?ES_TRISTATE_ON:ES_TRISTATE_OFF;}catch (e){return ES_TRISTATE_OFF;};};ES.GetNamedCommandValue=function(A){var B='';var C=ES.GetNamedCommandState(A);if (C==ES_TRISTATE_DISABLED) return null;try{B=this.EditorDocument.queryCommandValue(A);}catch(e) {};return B?B:'';};ES.PasteFromWord=function(){ESDialog.OpenDialog('ESDialog_Paste',ESLang.PasteFromWord,'dialog/es_paste.html',400,330,'Word');};ES.Preview=function(){var A=ESConfig.ScreenWidth*0.8;var B=ESConfig.ScreenHeight*0.7;var C=(ESConfig.ScreenWidth-A)/2;var D=window.open('',null,'toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width='+A+',height='+B+',left='+C);var E;if (ESConfig.FullPage){if (ES.TempBaseTag.length>0) E=ES.GetXHTML().replace(ESRegexLib.HeadOpener,'$&'+ES.TempBaseTag);else E=ES.GetXHTML();}else{E=ESConfig.DocType+'<html dir="'+ESConfig.ContentLangDirection+'">'+'<head><title>'+ESLang.Preview+'</title>'+'<link href="'+ESConfig.EditorAreaCSS+'" rel="stylesheet" type="text/css" />'+ES.TempBaseTag+'</head><body>'+ES.GetXHTML()+'</body></html>';};D.document.write(E);D.document.close();};ES.SwitchEditMode=function(){var A=(ES.EditMode==ES_EDITMODE_WYSIWYG);document.getElementById('eWysiwyg').style.display=A?'none':'';document.getElementById('eSource').style.display=A?'':'none';if (A){if (ESBrowserInfo.IsIE) ESUndo.SaveUndoStep();document.getElementById('eSourceField').value=ES.GetXHTML(ESConfig.FormatSource);}else ES.SetHTML(document.getElementById('eSourceField').value,true);ES.EditMode=A?ES_EDITMODE_SOURCE:ES_EDITMODE_WYSIWYG;ESToolbarSet.RefreshModeState();ES.Focus();};ES.CreateElement=function(A){var e=ES.EditorDocument.createElement(A);return ES.InsertElementAndGetIt(e);};ES.InsertElementAndGetIt=function(e){e.setAttribute('__ESTempLabel',1);this.InsertElement(e);var A=ES.EditorDocument.getElementsByTagName(e.tagName);for (var i=0;i<A.length;i++){if (A[i].getAttribute('__ESTempLabel')){A[i].removeAttribute('__ESTempLabel');return A[i];};};return null;};
ES.Paste=function(){if (ESConfig.ForcePasteAsPlainText){ES.PasteAsPlainText();return false;}else if (ESConfig.AutoDetectPasteFromWord){var A=ES.GetClipboardHTML();var B=/<\w[^>]*(( class="?MsoNormal"?)|(="mso-))/gi;if (B.test(A)){if (confirm(ESLang["PasteWordConfirm"])){ES.PasteFromWord();return false;};};}else return true;};ES.PasteAsPlainText=function(){var A=ESTools.HTMLEncode(clipboardData.getData("Text"));A=A.replace(/\n/g,'<BR>');this.InsertHtml(A);};ES.InsertElement=function(A){ES.InsertHtml(A.outerHTML);};ES.GetClipboardHTML=function(){var A=document.getElementById('___ESHiddenDiv');if (!A){var A=document.createElement('DIV');A.id='___ESHiddenDiv';A.style.visibility='hidden';A.style.overflow='hidden';A.style.position='absolute';A.style.width=1;A.style.height=1;document.body.appendChild(A);};A.innerHTML='';var C=document.body.createTextRange();C.moveToElementText(A);C.execCommand('Paste');var D=A.innerHTML;A.innerHTML='';return D;};ES.AttachToOnSelectionChange=function(A){this.Events.AttachEvent('OnSelectionChange',A);};ES.CreateLink=function(A){ES.ExecuteNamedCommand('Unlink');if (A.length>0){var B='javascript:void(0);/*'+(new Date().getTime())+'*/';ES.ExecuteNamedCommand('CreateLink',B);var C=this.EditorDocument.links;for (i=0;i<C.length;i++){if (C[i].href==B){C[i].href=A;return C[i];};};};};
var ESSelection=new Object();ES.Selection=ESSelection;
ESSelection.GetType=function(){return ES.EditorDocument.selection.type;};ESSelection.GetSelectedElement=function(){if (this.GetType()=='Control'){var A=ES.EditorDocument.selection.createRange();if (A&&A.item) return ES.EditorDocument.selection.createRange().item(0);};};ESSelection.GetParentElement=function(){switch (this.GetType()){case 'Control':return ESSelection.GetSelectedElement().parentElement;case 'None':return;default:return ES.EditorDocument.selection.createRange().parentElement();};};ESSelection.SelectNode=function(A){ES.Focus();ES.EditorDocument.selection.empty();var B=ES.EditorDocument.selection.createRange();B.moveToElementText(A);B.select();};ESSelection.Collapse=function(A){ES.Focus();var B=ES.EditorDocument.selection.createRange();B.collapse(A==null||A===true);B.select();};ESSelection.HasAncestorNode=function(A){var B;if (ES.EditorDocument.selection.type=="Control"){B=this.GetSelectedElement();}else{var C=ES.EditorDocument.selection.createRange();B=C.parentElement();};while (B){if (B.tagName==A) return true;B=B.parentNode;};return false;};ESSelection.MoveToAncestorNode=function(A){var B;if (ES.EditorDocument.selection.type=="Control"){var C=ES.EditorDocument.selection.createRange();for (i=0;i<C.length;i++){if (C(i).parentNode){B=C(i).parentNode;break;};};}else{var C=ES.EditorDocument.selection.createRange();B=C.parentElement();};while (B&&B.nodeName!=A) B=B.parentNode;return B;};ESSelection.Delete=function(){var A=ES.EditorDocument.selection;if (A.type.toLowerCase()!="none"){A.clear();};return A;};
var ESPanel=function(A){this.IsRTL=false;this.IsContextMenu=false;this._IsOpened=false;this._Window=A?A:window;this._Popup=this._Window.createPopup();this.Document=this._Popup.document;this.PanelDiv=this.Document.body.appendChild(this.Document.createElement('DIV'));this.PanelDiv.className='ES_Panel';this.EnableContextMenu(false);this.SetDirection(ESLang.Dir);};ESPanel.prototype.EnableContextMenu=function(A){this.Document.oncontextmenu=A?null:ESTools.CancelEvent;};ESPanel.prototype.AppendStyleSheet=function(A){ESTools.AppendStyleSheet(this.Document,A);};ESPanel.prototype.SetDirection=function(A){this.IsRTL=(A=='rtl');this.Document.dir=A;};ESPanel.prototype.Load=function(x,y,A){this._Popup.show(x,y,0,0,A);};ESPanel.prototype.Show=function(x,y,A,B,C){this.Load(x,y,A);this.PanelDiv.style.width=B?B+'px':'';this.PanelDiv.style.height=C?C+'px':'';if (this.IsRTL){if (this.IsContextMenu) x=x-this.PanelDiv.offsetWidth+1;else if (A) x=x+(A.offsetWidth-this.PanelDiv.offsetWidth);};this._Popup.show(x,y,this.PanelDiv.offsetWidth,this.PanelDiv.offsetHeight,A);if (this._OnHide){if (ESPanel_ActivePopupInfo.Timer) CheckPopupOnHide();ESPanel_ActivePopupInfo.Timer=window.setInterval(CheckPopupOnHide,200);ESPanel_ActivePopupInfo.Panel=this;};this._IsOpened=true;};ESPanel.prototype.Hide=function(){this._Popup.hide();};ESPanel.prototype.CheckIsOpened=function(){return this._Popup.isOpen;};ESPanel.prototype.AttachToOnHideEvent=function(A){this._OnHide=A;};var ESPanel_ActivePopupInfo=new Object();function CheckPopupOnHide(){var oPanel=ESPanel_ActivePopupInfo.Panel;if (oPanel&&!oPanel._Popup.isOpen){window.clearInterval(ESPanel_ActivePopupInfo.Timer);if (oPanel._OnHide) oPanel._OnHide(oPanel);ESPanel_ActivePopupInfo.Timer=null;ESPanel_ActivePopupInfo.Panel=null;};}
var ESTableHandler=new Object();ESTableHandler.InsertRow=function(){var A=ESSelection.MoveToAncestorNode("TR");if (!A) return;var B=A.cloneNode(true);A.parentNode.insertBefore(B,A);ESTableHandler.ClearRow(A);};ESTableHandler.DeleteRows=function(A){if (!A) A=ESSelection.MoveToAncestorNode("TR");if (!A) return;var B=ESTools.GetElementAscensor(A,'TABLE');if (B.rows.length==1){ESTableHandler.DeleteTable(B);return;};A.parentNode.removeChild(A);};ESTableHandler.DeleteTable=function(A){if (!A){var A=ESSelection.GetSelectedElement();if (!A||A.tagName!='TABLE') A=ESSelection.MoveToAncestorNode("TABLE");};if (!A) return;ESSelection.SelectNode(A);ESSelection.Collapse();A.parentNode.removeChild(A);};ESTableHandler.InsertColumn=function(){var A=ESSelection.MoveToAncestorNode("TD");if (!A) A=ESSelection.MoveToAncestorNode("TH");if (!A) return;var B=ESTools.GetElementAscensor(A,'TABLE');var C=A.cellIndex+1;for (var i=0;i<B.rows.length;i++){var D=B.rows[i];if (D.cells.length<C) continue;A=D.cells[C-1].cloneNode(false);if (ESBrowserInfo.IsGecko) A.innerHTML=ESBrowserInfo.IsGecko?GECKO_BOGUS:'';var E=D.cells[C];if (E) D.insertBefore(A,E);else D.appendChild(A);};};ESTableHandler.DeleteColumns=function(){var A=ESSelection.MoveToAncestorNode('TD')||ESSelection.MoveToAncestorNode('TH');if (!A) return;var B=ESTools.GetElementAscensor(A,'TABLE');var C=A.cellIndex;for (var i=B.rows.length-1;i>=0;i--){var D=B.rows[i];if (C==0&&D.cells.length==1){ESTableHandler.DeleteRows(D);continue;};if (D.cells[C]) D.removeChild(D.cells[C]);};};ESTableHandler.InsertCell=function(A){var B=A?A:ESSelection.MoveToAncestorNode("TD");if (!B) return;var C=ES.EditorDocument.createElement("TD");if (ESBrowserInfo.IsGecko) C.innerHTML=GECKO_BOGUS;if (B.cellIndex==B.parentNode.cells.length-1){B.parentNode.appendChild(C);}else{B.parentNode.insertBefore(C,B.nextSibling);};return C;};ESTableHandler.DeleteCell=function(A){if (A.parentNode.cells.length==1){ESTableHandler.DeleteRows(ESTools.GetElementAscensor(A,'TR'));return;};A.parentNode.removeChild(A);};ESTableHandler.DeleteCells=function(){var A=ESTableHandler.GetSelectedCells();for (var i=A.length-1;i>=0;i--){ESTableHandler.DeleteCell(A[i]);};};ESTableHandler.MergeCells=function(){var A=ESTableHandler.GetSelectedCells();if (A.length<2) return;if (A[0].parentNode!=A[A.length-1].parentNode) return;var B=isNaN(A[0].colSpan)?1:A[0].colSpan;var C='';for (var i=A.length-1;i>0;i--){B+=isNaN(A[i].colSpan)?1:A[i].colSpan;C=A[i].innerHTML+C;ESTableHandler.DeleteCell(A[i]);};A[0].colSpan=B;A[0].innerHTML+=C;};ESTableHandler.SplitCell=function(){var A=ESTableHandler.GetSelectedCells();if (A.length!=1) return;var B=this._CreateTableMap(A[0].parentNode.parentNode);var C=ESTableHandler._GetCellIndexSpan(B,A[0].parentNode.rowIndex,A[0]);var D=this._GetCollumnCells(B,C);for (var i=0;i<D.length;i++){if (D[i]==A[0]){var E=this.InsertCell(A[0]);if (!isNaN(A[0].rowSpan)&&A[0].rowSpan>1) E.rowSpan=A[0].rowSpan;}else{if (isNaN(D[i].colSpan)) D[i].colSpan=2;else D[i].colSpan+=1;};};};ESTableHandler._GetCellIndexSpan=function(A,B,C){if (A.length<B+1) return null;var D=A[B];for (var c=0;c<D.length;c++){if (D[c]==C) return c;};return null;};ESTableHandler._GetCollumnCells=function(A,B){var C=new Array();for (var r=0;r<A.length;r++){var D=A[r][B];if (D&&(C.length==0||C[C.length-1]!=D)) C[C.length]=D;};return C;};ESTableHandler._CreateTableMap=function(A){var B=A.rows;var r=-1;var C=new Array();for (var i=0;i<B.length;i++){r++;if (!C[r]) C[r]=new Array();var c=-1;for (var j=0;j<B[i].cells.length;j++){var D=B[i].cells[j];c++;while (C[r][c]) c++;var E=isNaN(D.colSpan)?1:D.colSpan;var F=isNaN(D.rowSpan)?1:D.rowSpan;for (var G=0;G<F;G++){if (!C[r+G]) C[r+G]=new Array();for (var H=0;H<E;H++){C[r+G][c+H]=B[i].cells[j];};};c+=E-1;};};return C;};ESTableHandler.ClearRow=function(A){var B=A.cells;for (var i=0;i<B.length;i++){if (ESBrowserInfo.IsGecko) B[i].innerHTML=GECKO_BOGUS;else B[i].innerHTML='';};};
ESTableHandler.GetSelectedCells=function(){var A=new Array();var B=ES.EditorDocument.selection.createRange();var C=ESSelection.GetParentElement();if (C&&C.tagName=="TD") A[0]=C;else{var C=ESSelection.MoveToAncestorNode("TABLE");if (C){for (var i=0;i<C.cells.length;i++){var E=ES.EditorDocument.selection.createRange();E.moveToElementText(C.cells[i]);if (B.inRange(E)||(B.compareEndPoints('StartToStart',E)>=0&&B.compareEndPoints('StartToEnd',E)<=0)||(B.compareEndPoints('EndToStart',E)>=0&&B.compareEndPoints('EndToEnd',E)<=0)){A[A.length]=C.cells[i];};};};};return A;};
var ESXml;if (!(ESXml=NS.ESXml)){ESXml=NS.ESXml=function(){this.Error=false;};ESXml.prototype.LoadUrl=function(A){this.Error=false;var B=ESTools.CreateXmlObject('XmlHttp');if (!B){this.Error=true;return;};B.open("GET",A,false);B.send(null);if (B.status==200||B.status==304) this.DOMDocument=B.responseXML;else if (B.status==0&&B.readyState==4){this.DOMDocument=ESTools.CreateXmlObject('DOMDocument');this.DOMDocument.async=false;this.DOMDocument.resolveExternals=false;this.DOMDocument.loadXML(B.responseText);}else{this.Error=true;alert('Error loading "'+A+'"');};};ESXml.prototype.SelectNodes=function(A,B){if (this.Error) return new Array();if (B) return B.selectNodes(A);else return this.DOMDocument.selectNodes(A);};ESXml.prototype.SelectSingleNode=function(A,B){if (this.Error) return;if (B) return B.selectSingleNode(A);else return this.DOMDocument.selectSingleNode(A);};}
var ESStyleDef=function(A,B){this.Name=A;this.Element=B.toUpperCase();this.IsObjectElement=ESRegexLib.ObjectElements.test(this.Element);this.Attributes=new Object();};ESStyleDef.prototype.AddAttribute=function(A,B){this.Attributes[A]=B;};ESStyleDef.prototype.GetOpenerTag=function(){var s='<'+this.Element;for (var a in this.Attributes) s+=' '+a+'="'+this.Attributes[a]+'"';return s+'>';};ESStyleDef.prototype.GetCloserTag=function(){return '</'+this.Element+'>';};ESStyleDef.prototype.RemoveFromSelection=function(){if (ESSelection.GetType()=='Control') this._RemoveMe(ESSelection.GetSelectedElement());else this._RemoveMe(ESSelection.GetParentElement());}
ESStyleDef.prototype.ApplyToSelection=function(){var A=ES.EditorDocument.selection;if (A.type=='Text'){var B=A.createRange();var e=document.createElement(this.Element);e.innerHTML=B.htmlText;this._AddAttributes(e);this._RemoveDuplicates(e);B.pasteHTML(e.outerHTML);}else if (A.type=='Control'){var C=ESSelection.GetSelectedElement();if (C.tagName==this.Element) this._AddAttributes(C);};};ESStyleDef.prototype._AddAttributes=function(A){for (var a in this.Attributes){switch (a.toLowerCase()){case 'style':A.style.cssText=this.Attributes[a];break;case 'class':A.setAttribute('className',this.Attributes[a],0);break;default:A.setAttribute(a,this.Attributes[a],0);};};};ESStyleDef.prototype._RemoveDuplicates=function(A){for (var i=0;i<A.children.length;i++){var B=A.children[i];this._RemoveDuplicates(B);if (this.IsEqual(B)) ESTools.RemoveOuterTags(B);};};ESStyleDef.prototype.IsEqual=function(e){if (e.tagName!=this.Element) return false;for (var a in this.Attributes){switch (a.toLowerCase()){case 'style':if (e.style.cssText.toLowerCase()!=this.Attributes[a].toLowerCase()) return false;break;case 'class':if (e.getAttribute('className',0)!=this.Attributes[a]) return false;break;default:if (e.getAttribute(a,0)!=this.Attributes[a]) return false;};};return true;};ESStyleDef.prototype._RemoveMe=function(A){if (!A) return;var B=A.parentElement;if (this.IsEqual(A)){if (this.IsObjectElement){for (var a in this.Attributes){switch (a.toLowerCase()){case 'class':A.removeAttribute('className',0);break;default:A.removeAttribute(a,0);};};return;}else ESTools.RemoveOuterTags(A);};this._RemoveMe(B);}
var ESStylesLoader=function(){this.Styles=new Object();this.StyleGroups=new Object();this.Loaded=false;this.HasObjectElements=false;};ESStylesLoader.prototype.Load=function(A){var B=new ESXml();B.LoadUrl(A);var C=B.SelectNodes('Styles/Style');for (var i=0;i<C.length;i++){var D=C[i].attributes.getNamedItem('element').value.toUpperCase();var E=new ESStyleDef(C[i].attributes.getNamedItem('name').value,D);if (E.IsObjectElement) this.HasObjectElements=true;var F=B.SelectNodes('Attribute',C[i]);for (var j=0;j<F.length;j++){var G=F[j].attributes.getNamedItem('name').value;var H=F[j].attributes.getNamedItem('value').value;if (G.toLowerCase()=='style'){var I=document.createElement('SPAN');I.style.cssText=H;H=I.style.cssText;};E.AddAttribute(G,H);};this.Styles[E.Name]=E;var J=this.StyleGroups[D];if (J==null){this.StyleGroups[D]=new Array();J=this.StyleGroups[D];};J[J.length]=E;};this.Loaded=true;}
var ESNamedCommand=function(A){this.Name=A;};ESNamedCommand.prototype.Execute=function(){ES.ExecuteNamedCommand(this.Name);};ESNamedCommand.prototype.GetState=function(){return ES.GetNamedCommandState(this.Name);};
var ESDialogCommand=function(A,B,C,D,E,F,G){this.Name=A;this.Title=B;this.Url=C;this.Width=D;this.Height=E;this.GetStateFunction=F;this.GetStateParam=G;};ESDialogCommand.prototype.Execute=function(){ESDialog.OpenDialog('ESDialog_'+this.Name,this.Title,this.Url,this.Width,this.Height);};ESDialogCommand.prototype.GetState=function(){if (this.GetStateFunction) return this.GetStateFunction(this.GetStateParam);else return ES_TRISTATE_OFF;};var ESUndefinedCommand=function(){this.Name='Undefined';};ESUndefinedCommand.prototype.Execute=function(){alert(ESLang.NotImplemented);};ESUndefinedCommand.prototype.GetState=function(){return ES_TRISTATE_OFF;};var ESFontNameCommand=function(){this.Name='FontName';};ESFontNameCommand.prototype.Execute=function(A){if (A==null||A==""){}else ES.ExecuteNamedCommand('FontName',A);};ESFontNameCommand.prototype.GetState=function(){return ES.GetNamedCommandValue('FontName');};var ESFontSizeCommand=function(){this.Name='FontSize';};ESFontSizeCommand.prototype.Execute=function(A){if (typeof(A)=='string') A=parseInt(A);if (A==null||A==''){ES.ExecuteNamedCommand('FontSize',3);}else ES.ExecuteNamedCommand('FontSize',A);};ESFontSizeCommand.prototype.GetState=function(){return ES.GetNamedCommandValue('FontSize');};var ESFormatBlockCommand=function(){this.Name='FormatBlock';};ESFormatBlockCommand.prototype.Execute=function(A){if (A==null||A=='') ES.ExecuteNamedCommand('FormatBlock','<P>');else if (A=='div'&&ESBrowserInfo.IsGecko) ES.ExecuteNamedCommand('FormatBlock','div');else ES.ExecuteNamedCommand('FormatBlock','<'+A+'>');};ESFormatBlockCommand.prototype.GetState=function(){return ES.GetNamedCommandValue('FormatBlock');};var ESPreviewCommand=function(){this.Name='Preview';};ESPreviewCommand.prototype.Execute=function(){ES.Preview();};ESPreviewCommand.prototype.GetState=function(){return ES_TRISTATE_OFF;};var ESSaveCommand=function(){this.Name='Save';};ESSaveCommand.prototype.Execute=function(){var A=ES.LinkedField.form;if (typeof(A.onsubmit)=='function'){var B=A.onsubmit();if (B!=null&&B===false) return;};A.submit();};ESSaveCommand.prototype.GetState=function(){return ES_TRISTATE_OFF;};var ESNewPageCommand=function(){this.Name='NewPage';};ESNewPageCommand.prototype.Execute=function(){ESUndo.SaveUndoStep();ES.SetHTML('');ESUndo.Typing=true;};ESNewPageCommand.prototype.GetState=function(){return ES_TRISTATE_OFF;};var ESSourceCommand=function(){this.Name='Source';};ESSourceCommand.prototype.Execute=function(){if (ESBrowserInfo.IsGecko){var A=ESConfig.ScreenWidth*0.65;var B=ESConfig.ScreenHeight*0.65;ESDialog.OpenDialog('ESDialog_Source',ESLang.Source,'dialog/es_source.html',A,B,null,null,true);}else ES.SwitchEditMode();};ESSourceCommand.prototype.GetState=function(){return (ES.EditMode==ES_EDITMODE_WYSIWYG?ES_TRISTATE_OFF:ES_TRISTATE_ON);};var ESUndoCommand=function(){this.Name='Undo';};ESUndoCommand.prototype.Execute=function(){if (ESBrowserInfo.IsIE) ESUndo.Undo();else ES.ExecuteNamedCommand('Undo');};ESUndoCommand.prototype.GetState=function(){if (ESBrowserInfo.IsIE) return (ESUndo.CheckUndoState()?ES_TRISTATE_OFF:ES_TRISTATE_DISABLED);else return ES.GetNamedCommandState('Undo');};var ESRedoCommand=function(){this.Name='Redo';};ESRedoCommand.prototype.Execute=function(){if (ESBrowserInfo.IsIE) ESUndo.Redo();else ES.ExecuteNamedCommand('Redo');};ESRedoCommand.prototype.GetState=function(){if (ESBrowserInfo.IsIE) return (ESUndo.CheckRedoState()?ES_TRISTATE_OFF:ES_TRISTATE_DISABLED);else return ES.GetNamedCommandState('Redo');};var ESPageBreakCommand=function(){this.Name='PageBreak';};ESPageBreakCommand.prototype.Execute=function(){var e=ES.EditorDocument.createElement('DIV');e.style.pageBreakAfter='always';e.innerHTML='<span style="DISPLAY:none">&nbsp;</span>';var A=ESDocumentProcessors_CreateFakeImage('ES__PageBreak',e);A=ES.InsertElement(A);};ESPageBreakCommand.prototype.GetState=function(){return 0;}
var ESSpellCheckCommand=function(){this.Name='SpellCheck';this.IsEnabled=(ESConfig.SpellChecker=='ieSpell'||ESConfig.SpellChecker=='SpellerPages');};ESSpellCheckCommand.prototype.Execute=function(){switch (ESConfig.SpellChecker){case 'ieSpell':this._RunIeSpell();break;case 'SpellerPages':ESDialog.OpenDialog('ESDialog_SpellCheck','Spell Check','dialog/es_spellerpages.html',440,480);break;};};ESSpellCheckCommand.prototype._RunIeSpell=function(){try{var A=new ActiveXObject("ieSpell.ieSpellExtension");A.CheckAllLinkedDocuments(ES.EditorDocument);}catch(e){if(e.number==-2146827859){if (confirm(ESLang.IeSpellDownload)) window.open(ESConfig.IeSpellDownloadUrl,'IeSpellDownload');}else alert('Error Loading ieSpell: '+e.message+' ('+e.number+')');};};ESSpellCheckCommand.prototype.GetState=function(){return this.IsEnabled?ES_TRISTATE_OFF:ES_TRISTATE_DISABLED;}
var ESTextColorCommand=function(A){this.Name=A=='ForeColor'?'TextColor':'BGColor';this.Type=A;this._Panel=new ESPanel();this._Panel.AppendStyleSheet(ESConfig.SkinPath+'es_contextmenu.css');this._CreatePanelBody(this._Panel.Document,this._Panel.PanelDiv);ESTools.DisableSelection(this._Panel.Document.body);};ESTextColorCommand.prototype.Execute=function(A,B,C){ES._ActiveColorPanelType=this.Type;this._Panel.Show(A,B,C);};ESTextColorCommand.prototype.SetColor=function(A){if (ES._ActiveColorPanelType=='ForeColor') ES.ExecuteNamedCommand('ForeColor',A);else if (ESBrowserInfo.IsGecko) ES.ExecuteNamedCommand('hilitecolor',A);else ES.ExecuteNamedCommand('BackColor',A);delete ES._ActiveColorPanelType;};ESTextColorCommand.prototype.GetState=function(){return ES_TRISTATE_OFF;};function ESTextColorCommand_OnMouseOver()	{ this.className='ColorSelected';};function ESTextColorCommand_OnMouseOut()	{ this.className='ColorDeselected';};function ESTextColorCommand_OnClick(){this.className='ColorDeselected';this.Command.SetColor('#'+this.Color);this.Command._Panel.Hide();};function ESTextColorCommand_AutoOnClick(){this.className='ColorDeselected';this.Command.SetColor('');this.Command._Panel.Hide();};function ESTextColorCommand_MoreOnClick(){this.className='ColorDeselected';this.Command._Panel.Hide();ESDialog.OpenDialog('ESDialog_Color',ESLang.DlgColorTitle,'dialog/es_colorselector.html',400,330,this.Command.SetColor);};ESTextColorCommand.prototype._CreatePanelBody=function(A,B){function CreateSelectionDiv(){var C=A.createElement("DIV");C.className='ColorDeselected';C.onmouseover=ESTextColorCommand_OnMouseOver;C.onmouseout=ESTextColorCommand_OnMouseOut;return C;};var D=B.appendChild(A.createElement("TABLE"));D.className='ForceBaseFont';D.style.tableLayout='fixed';D.cellPadding=0;D.cellSpacing=0;D.border=0;D.width=150;var E=D.insertRow(-1).insertCell(-1);E.colSpan=8;var C=E.appendChild(CreateSelectionDiv());C.innerHTML='<table cellspacing="0" cellpadding="0" width="100%" border="0">\<tr>\<td><div class="ColorBoxBorder"><div class="ColorBox" style="background-color: #000000"></div></div></td>\<td nowrap width="100%" align="center">' + ESLang.ColorAutomatic + '</td>\</tr>\</table>';C.Command=this;C.onclick=ESTextColorCommand_AutoOnClick;var G=ESConfig.FontColors.toString().split(',');var H=0;while (H<G.length){var I=D.insertRow(-1);for (var i=0;i<8&&H<G.length;i++,H++){C=I.insertCell(-1).appendChild(CreateSelectionDiv());C.Color=G[H];C.innerHTML='<div class="ColorBoxBorder"><div class="ColorBox" style="background-color: #'+G[H]+'"></div></div>';C.Command=this;C.onclick=ESTextColorCommand_OnClick;};};E=D.insertRow(-1).insertCell(-1);E.colSpan=8;C=E.appendChild(CreateSelectionDiv());C.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td nowrap align="center">'+ESLang.ColorMoreColors+'</td></tr></table>';C.Command=this;C.onclick=ESTextColorCommand_MoreOnClick;}
var ESPastePlainTextCommand=function(){this.Name='PasteText';};ESPastePlainTextCommand.prototype.Execute=function(){ES.PasteAsPlainText();};ESPastePlainTextCommand.prototype.GetState=function(){return ES.GetNamedCommandState('Paste');};
var ESPasteWordCommand=function(){this.Name='PasteWord';};ESPasteWordCommand.prototype.Execute=function(){ES.PasteFromWord();};ESPasteWordCommand.prototype.GetState=function(){if (ESConfig.ForcePasteAsPlainText) return ES_TRISTATE_DISABLED;else return ES.GetNamedCommandState('Paste');};
var ESTableCommand=function(A){this.Name=A;};ESTableCommand.prototype.Execute=function(){ESUndo.SaveUndoStep();switch (this.Name){case 'TableInsertRow':ESTableHandler.InsertRow();break;case 'TableDeleteRows':ESTableHandler.DeleteRows();break;case 'TableInsertColumn':ESTableHandler.InsertColumn();break;case 'TableDeleteColumns':ESTableHandler.DeleteColumns();break;case 'TableInsertCell':ESTableHandler.InsertCell();break;case 'TableDeleteCells':ESTableHandler.DeleteCells();break;case 'TableMergeCells':ESTableHandler.MergeCells();break;case 'TableSplitCell':ESTableHandler.SplitCell();break;case 'TableDelete':ESTableHandler.DeleteTable();break;default:alert(ESLang.UnknownCommand.replace(/%1/g,this.Name));};};ESTableCommand.prototype.GetState=function(){return ES_TRISTATE_OFF;}
var ESStyleCommand=function(){this.Name='Style';this.StylesLoader=new ESStylesLoader();this.StylesLoader.Load(ESConfig.StylesXmlPath);this.Styles=this.StylesLoader.Styles;};ESStyleCommand.prototype.Execute=function(A,B){ESUndo.SaveUndoStep();if (B.Selected) B.Style.RemoveFromSelection();else B.Style.ApplyToSelection();ESUndo.SaveUndoStep();ES.Focus();ES.Events.FireEvent("OnSelectionChange");};ESStyleCommand.prototype.GetState=function(){var A=ES.EditorDocument.selection;if (ESSelection.GetType()=='Control'){var e=ESSelection.GetSelectedElement();if (e) return this.StylesLoader.StyleGroups[e.tagName]?ES_TRISTATE_OFF:ES_TRISTATE_DISABLED;};return ES_TRISTATE_OFF;};ESStyleCommand.prototype.GetActiveStyles=function(){var A=new Array();if (ESSelection.GetType()=='Control') this._CheckStyle(ESSelection.GetSelectedElement(),A,false);else this._CheckStyle(ESSelection.GetParentElement(),A,true);return A;};ESStyleCommand.prototype._CheckStyle=function(A,B,C){if (!A) return;if (A.nodeType==1){var D=this.StylesLoader.StyleGroups[A.tagName];if (D){for (var i=0;i<D.length;i++){if (D[i].IsEqual(A)) B[B.length]=D[i];};};};if (C) this._CheckStyle(A.parentNode,B,C);}
var ESCommands=ES.Commands=new Object();ESCommands.LoadedCommands=new Object();ESCommands.RegisterCommand=function(A,B){this.LoadedCommands[A]=B;};ESCommands.GetCommand=function(A){var B=ESCommands.LoadedCommands[A];if (B) return B;switch (A){case 'DocProps':B=new ESDialogCommand('DocProps',ESLang.DocProps,'dialog/es_docprops.html',400,390,ESCommands.GetFullPageState);break;case 'Templates':B=new ESDialogCommand('Templates',ESLang.DlgTemplatesTitle,'dialog/es_template.html',380,450);break;case 'Link':B=new ESDialogCommand('Link',ESLang.DlgLnkWindowTitle,'dialog/es_link.html',400,330,ES.GetNamedCommandState,'CreateLink');break;case 'Anchor':B=new ESDialogCommand('Anchor',ESLang.DlgAnchorTitle,'dialog/es_anchor.html',370,170);break;case 'BulletedList':B=new ESDialogCommand('BulletedList',ESLang.BulletedListProp,'dialog/es_listprop.html',370,170);break;case 'NumberedList':B=new ESDialogCommand('NumberedList',ESLang.NumberedListProp,'dialog/es_listprop.html',370,170);break;case 'About':B=new ESDialogCommand('About',ESLang.About,'dialog/es_about.html',400,330);break;case 'Find':B=new ESDialogCommand('Find',ESLang.DlgFindTitle,'dialog/es_find.html',340,170);break;case 'Replace':B=new ESDialogCommand('Replace',ESLang.DlgReplaceTitle,'dialog/es_replace.html',340,200);break;case 'Image':B=new ESDialogCommand('Image',ESLang.DlgImgTitle,'dialog/es_image.html',450,400);break;case 'Library':B=new ESDialogCommand('Library',ESLang.DlgImgTitle,'dialog/es_library.html',450,400);break;case 'Flash':B=new ESDialogCommand('Flash',ESLang.DlgFlashTitle,'dialog/es_flash.html',450,400);break;case 'SpecialChar':B=new ESDialogCommand('SpecialChar',ESLang.DlgSpecialCharTitle,'dialog/es_specialchar.html',400,320);break;case 'Smiley':B=new ESDialogCommand('Smiley',ESLang.DlgSmileyTitle,'dialog/es_smiley.html',ESConfig.SmileyWindowWidth,ESConfig.SmileyWindowHeight);break;case 'Table':B=new ESDialogCommand('Table',ESLang.DlgTableTitle,'dialog/es_table.html',400,250);break;case 'TableProp':B=new ESDialogCommand('Table',ESLang.DlgTableTitle,'dialog/es_table.html?Parent',400,250);break;case 'TableCellProp':B=new ESDialogCommand('TableCell',ESLang.DlgCellTitle,'dialog/es_tablecell.html',500,250);break;case 'UniversalKey':B=new ESDialogCommand('UniversalKey',ESLang.UniversalKeyboard,'dialog/es_universalkey.html',415,300);break;case 'Style':B=new ESStyleCommand();break;case 'FontName':B=new ESFontNameCommand();break;case 'FontSize':B=new ESFontSizeCommand();break;case 'FontFormat':B=new ESFormatBlockCommand();break;case 'Source':B=new ESSourceCommand();break;case 'Preview':B=new ESPreviewCommand();break;case 'Save':B=new ESSaveCommand();break;case 'NewPage':B=new ESNewPageCommand();break;case 'PageBreak':B=new ESPageBreakCommand();break;case 'TextColor':B=new ESTextColorCommand('ForeColor');break;case 'BGColor':B=new ESTextColorCommand('BackColor');break;case 'PasteText':B=new ESPastePlainTextCommand();break;case 'PasteWord':B=new ESPasteWordCommand();break;case 'TableInsertRow':B=new ESTableCommand('TableInsertRow');break;case 'TableDeleteRows':B=new ESTableCommand('TableDeleteRows');break;case 'TableInsertColumn':B=new ESTableCommand('TableInsertColumn');break;case 'TableDeleteColumns':B=new ESTableCommand('TableDeleteColumns');break;case 'TableInsertCell':B=new ESTableCommand('TableInsertCell');break;case 'TableDeleteCells':B=new ESTableCommand('TableDeleteCells');break;case 'TableMergeCells':B=new ESTableCommand('TableMergeCells');break;case 'TableSplitCell':B=new ESTableCommand('TableSplitCell');break;case 'TableDelete':B=new ESTableCommand('TableDelete');break;case 'Form':B=new ESDialogCommand('Form',ESLang.Form,'dialog/es_form.html',380,230);break;case 'Checkbox':B=new ESDialogCommand('Checkbox',ESLang.Checkbox,'dialog/es_checkbox.html',380,230);break;case 'Radio':B=new ESDialogCommand('Radio',ESLang.RadioButton,'dialog/es_radiobutton.html',380,230);break;case 'TextField':B=new ESDialogCommand('TextField',ESLang.TextField,'dialog/es_textfield.html',380,230);break;case 'Textarea':B=new ESDialogCommand('Textarea',ESLang.Textarea,'dialog/es_textarea.html',380,230);break;case 'HiddenField':B=new ESDialogCommand('HiddenField',ESLang.HiddenField,'dialog/es_hiddenfield.html',380,230);break;case 'Button':B=new ESDialogCommand('Button',ESLang.Button,'dialog/es_button.html',380,230);break;case 'Select':B=new ESDialogCommand('Select',ESLang.SelectionField,'dialog/es_select.html',400,380);break;case 'ImageButton':B=new ESDialogCommand('ImageButton',ESLang.ImageButton,'dialog/es_image.html?ImageButton',450,400);break;case 'SpellCheck':B=new ESSpellCheckCommand();break;case 'Undo':B=new ESUndoCommand();break;case 'Redo':B=new ESRedoCommand();break;case 'Undefined':B=new ESUndefinedCommand();break;default:if (ESRegexLib.NamedCommands.test(A)) B=new ESNamedCommand(A);else{alert(ESLang.UnknownCommand.replace(/%1/g,A));return null;};};ESCommands.LoadedCommands[A]=B;return B;};ESCommands.GetFullPageState=function(){return ESConfig.FullPage?ES_TRISTATE_OFF:ES_TRISTATE_DISABLED;};
var ESToolbarButton=function(A,B,C,D,E,F){this.Command=ESCommands.GetCommand(A);this.Label=B?B:A;this.Tooltip=C?C:(B?B:A);this.Style=D?D:ES_TOOLBARITEM_ONLYICON;this.SourceView=E?true:false;this.ContextSensitive=F?true:false;this.IconPath=ESConfig.SkinPath+'toolbar/'+A.toLowerCase()+'.gif';this.State=ES_UNKNOWN;};ESToolbarButton.prototype.CreateInstance=function(A){this.DOMDiv=document.createElement('div');this.DOMDiv.className='TB_Button_Off';this.DOMDiv.ESToolbarButton=this;var B='<table title="'+this.Tooltip+'" cellspacing="0" cellpadding="0" border="0">'+'<tr>';if (this.Style!=ES_TOOLBARITEM_ONLYTEXT) B+='<td class="TB_Icon"><img src="'+this.IconPath+'" width="21" height="21"></td>';if (this.Style!=ES_TOOLBARITEM_ONLYICON) B+='<td class="TB_Text" nowrap>'+this.Label+'</td>';B+='</tr>'+'</table>';this.DOMDiv.innerHTML=B;var C=A.DOMRow.insertCell(-1);C.appendChild(this.DOMDiv);this.RefreshState();};ESToolbarButton.prototype.RefreshState=function(){var A=this.Command.GetState();if (A==this.State) return;this.State=A;switch (this.State){case ES_TRISTATE_ON:this.DOMDiv.className='TB_Button_On';this.DOMDiv.onmouseover=ESToolbarButton_OnMouseOnOver;this.DOMDiv.onmouseout=ESToolbarButton_OnMouseOnOut;this.DOMDiv.onclick=ESToolbarButton_OnClick;break;case ES_TRISTATE_OFF:this.DOMDiv.className='TB_Button_Off';this.DOMDiv.onmouseover=ESToolbarButton_OnMouseOffOver;this.DOMDiv.onmouseout=ESToolbarButton_OnMouseOffOut;this.DOMDiv.onclick=ESToolbarButton_OnClick;break;default:this.Disable();break;};};function ESToolbarButton_OnMouseOnOver(){this.className='TB_Button_On TB_Button_On_Over';};function ESToolbarButton_OnMouseOnOut(){this.className='TB_Button_On';};function ESToolbarButton_OnMouseOffOver(){this.className='TB_Button_On TB_Button_Off_Over';};function ESToolbarButton_OnMouseOffOut(){this.className='TB_Button_Off';};function ESToolbarButton_OnClick(e){this.ESToolbarButton.Click(e);return false;};ESToolbarButton.prototype.Click=function(){this.Command.Execute();};ESToolbarButton.prototype.Enable=function(){this.RefreshState();};ESToolbarButton.prototype.Disable=function(){this.State=ES_TRISTATE_DISABLED;this.DOMDiv.className='TB_Button_Disabled';this.DOMDiv.onmouseover=null;this.DOMDiv.onmouseout=null;this.DOMDiv.onclick=null;}
var ESSpecialCombo=function(A,B,C,D,E){this.FieldWidth=B||100;this.PanelWidth=C||150;this.PanelMaxHeight=D||150;this.Label='&nbsp;';this.Caption=A;this.Tooltip=A;this.Style=ES_TOOLBARITEM_ICONTEXT;this.Enabled=true;this.Items=new Object();this._Panel=new ESPanel(E);this._Panel.AppendStyleSheet(ESConfig.SkinPath+'es_contextmenu.css');this._PanelBox=this._Panel.PanelDiv.appendChild(this._Panel.Document.createElement('DIV'));this._PanelBox.className='SC_Panel';this._PanelBox.style.width=this.PanelWidth+'px';this._PanelBox.innerHTML='<table cellpadding="0" cellspacing="0" width="100%" style="TABLE-LAYOUT: fixed"><tr><td nowrap></td></tr></table>';this._ItemsHolderEl=this._PanelBox.getElementsByTagName('TD')[0];};function ESSpecialCombo_ItemOnMouseOver(){this.className+=' SC_ItemOver';};function ESSpecialCombo_ItemOnMouseOut(){this.className=this.originalClass;};function ESSpecialCombo_ItemOnClick(){this.ESSpecialCombo._Panel.Hide();this.ESSpecialCombo.SetLabel(this.ESItemLabel);if (typeof(this.ESSpecialCombo.OnSelect)=='function') this.ESSpecialCombo.OnSelect(this.ESItemID,this);};ESSpecialCombo.prototype.AddItem=function(A,B,C){var D=this._ItemsHolderEl.appendChild(this._Panel.Document.createElement('DIV'));D.className=D.originalClass='SC_Item';D.innerHTML=B;D.ESItemID=A;D.ESItemLabel=C?C:A;D.ESSpecialCombo=this;D.Selected=false;D.onmouseover=ESSpecialCombo_ItemOnMouseOver;D.onmouseout=ESSpecialCombo_ItemOnMouseOut;D.onclick=ESSpecialCombo_ItemOnClick;this.Items[A.toString().toLowerCase()]=D;return D;};ESSpecialCombo.prototype.SelectItem=function(A){A=A?A.toString().toLowerCase():'';var B=this.Items[A];if (B){B.className=B.originalClass='SC_ItemSelected';B.Selected=true;};};ESSpecialCombo.prototype.SelectItemByLabel=function(A,B){for (var C in this.Items){var D=this.Items[C];if (D.ESItemLabel==A){D.className=D.originalClass='SC_ItemSelected';D.Selected=true;if (B) this.SetLabel(A);};};};ESSpecialCombo.prototype.DeselectAll=function(A){for (var i in this.Items){this.Items[i].className=this.Items[i].originalClass='SC_Item';this.Items[i].Selected=false;};if (A) this.SetLabel('');};ESSpecialCombo.prototype.SetLabelById=function(A){A=A?A.toString().toLowerCase():'';var B=this.Items[A];this.SetLabel(B?B.ESItemLabel:'');};ESSpecialCombo.prototype.SetLabel=function(A){this.Label=A.length==0?'&nbsp;':A;if (this._LabelEl) this._LabelEl.innerHTML=this.Label;};ESSpecialCombo.prototype.SetEnabled=function(A){this.Enabled=A;this._OuterTable.className=A?'':'SC_FieldDisabled';};ESSpecialCombo.prototype.Create=function(A){this._OuterTable=A.appendChild(document.createElement('TABLE'));this._OuterTable.cellPadding=0;this._OuterTable.cellSpacing=0;this._OuterTable.insertRow(-1);var B;var C;switch (this.Style){case ES_TOOLBARITEM_ONLYICON:B='TB_ButtonType_Icon';C=false;break;case ES_TOOLBARITEM_ONLYTEXT:B='TB_ButtonType_Text';C=false;break;case ES_TOOLBARITEM_ICONTEXT:C=true;break;};if (this.Caption&&this.Caption.length>0&&C){var D=this._OuterTable.rows[0].insertCell(-1);D.innerHTML=this.Caption;D.className='SC_FieldCaption';};var E=this._OuterTable.rows[0].insertCell(-1).appendChild(document.createElement('DIV'));if (C){E.className='SC_Field';E.style.width=this.FieldWidth+'px';E.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" style="TABLE-LAYOUT: fixed;"><tbody><tr><td class="SC_FieldLabel"><label>&nbsp;</label></td><td class="SC_FieldButton">&nbsp;</td></tr></tbody></table>';this._LabelEl=E.getElementsByTagName('label')[0];this._LabelEl.innerHTML=this.Label;}else{E.className='TB_Button_Off';E.innerHTML='<table cellpadding="0" cellspacing="0" style="TABLE-LAYOUT: fixed;"><tbody><tr><td class="SC_FieldButton" style="border-left: none;">&nbsp;</td></tr></tbody></table>';E.innerHTML='<table title="'+this.Tooltip+'" class="'+B+'" cellspacing="0" cellpadding="0" border="0">'+'<tr>'+'<td class="TB_Text">'+this.Caption+'</td>'+'<td class="TB_ButtonArrow"><img src="'+ESConfig.SkinPath+'images/toolbar.buttonarrow.gif" width="5" height="3"></td>'+'</tr>'+'</table>';};E.SpecialCombo=this;E.onmouseover=ESSpecialCombo_OnMouseOver;E.onmouseout=ESSpecialCombo_OnMouseOut;E.onclick=ESSpecialCombo_OnClick;ESTools.DisableSelection(this._Panel.Document.body);};function ESSpecialCombo_OnMouseOver(){if (this.SpecialCombo.Enabled){switch (this.SpecialCombo.Style){case ES_TOOLBARITEM_ONLYICON:this.className='TB_Button_On';break;case ES_TOOLBARITEM_ONLYTEXT:this.className='TB_Button_On';break;case ES_TOOLBARITEM_ICONTEXT:this.className='SC_Field SC_FieldOver';break;};};};function ESSpecialCombo_OnMouseOut(){switch (this.SpecialCombo.Style){case ES_TOOLBARITEM_ONLYICON:this.className='TB_Button_Off';break;case ES_TOOLBARITEM_ONLYTEXT:this.className='TB_Button_Off';break;case ES_TOOLBARITEM_ICONTEXT:this.className='SC_Field';break;};};function ESSpecialCombo_OnClick(e){var oSpecialCombo=this.SpecialCombo;if (oSpecialCombo.Enabled){var oPanel=oSpecialCombo._Panel;var oPanelBox=oSpecialCombo._PanelBox;var oItemsHolder=oSpecialCombo._ItemsHolderEl;var iMaxHeight=oSpecialCombo.PanelMaxHeight;if (oSpecialCombo.OnBeforeClick) oSpecialCombo.OnBeforeClick(oSpecialCombo);oPanel.Load(0,this.offsetHeight,this);if (oItemsHolder.offsetHeight>iMaxHeight) oPanelBox.style.height=iMaxHeight+'px';else oPanelBox.style.height=oItemsHolder.offsetHeight+'px';if (ESBrowserInfo.IsGecko) oPanelBox.style.overflow='-moz-scrollbars-vertical';oPanel.Show(0,this.offsetHeight,this);};return false;};
var ESToolbarSpecialCombo=function(){this.SourceView=false;this.ContextSensitive=true;};function ESToolbarSpecialCombo_OnSelect(itemId,item){this.Command.Execute(itemId,item);};ESToolbarSpecialCombo.prototype.CreateInstance=function(A){this._Combo=new ESSpecialCombo(this.GetLabel(),this.FieldWidth,this.PanelWidth,this.PanelMaxHeight);this._Combo.Tooltip=this.Tooltip;this._Combo.Style=this.Style;this.CreateItems(this._Combo);this._Combo.Create(A.DOMRow.insertCell(-1));this._Combo.Command=this.Command;this._Combo.OnSelect=ESToolbarSpecialCombo_OnSelect;};function ESToolbarSpecialCombo_RefreshActiveItems(combo,value){combo.DeselectAll();combo.SelectItem(value);combo.SetLabelById(value);};ESToolbarSpecialCombo.prototype.RefreshState=function(){var A;var B=this.Command.GetState();if (B!=ES_TRISTATE_DISABLED){A=ES_TRISTATE_ON;if (this.RefreshActiveItems) this.RefreshActiveItems(this._Combo,B);else{if (this._LastValue==B) return;this._LastValue=B;ESToolbarSpecialCombo_RefreshActiveItems(this._Combo,B);};}else A=ES_TRISTATE_DISABLED;if (A==this.State) return;if (A==ES_TRISTATE_DISABLED){this._Combo.DeselectAll();this._Combo.SetLabel('');};this.State=A;this._Combo.SetEnabled(A!=ES_TRISTATE_DISABLED);};ESToolbarSpecialCombo.prototype.Enable=function(){this.RefreshState();};ESToolbarSpecialCombo.prototype.Disable=function(){this.State=ES_TRISTATE_DISABLED;this._Combo.DeselectAll();this._Combo.SetLabel('');this._Combo.SetEnabled(false);}
var ESToolbarFontsCombo=function(A,B){this.Command=ESCommands.GetCommand('FontName');this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:ES_TOOLBARITEM_ICONTEXT;};ESToolbarFontsCombo.prototype=new ESToolbarSpecialCombo;ESToolbarFontsCombo.prototype.GetLabel=function(){return ESLang.Font;};ESToolbarFontsCombo.prototype.CreateItems=function(A){var B=ESConfig.FontNames.split(';');for (var i=0;i<B.length;i++) this._Combo.AddItem(B[i],'<font face="'+B[i]+'" style="font-size: 12px">'+B[i]+'</font>');}
var ESToolbarFontSizeCombo=function(A,B){this.Command=ESCommands.GetCommand('FontSize');this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:ES_TOOLBARITEM_ICONTEXT;};ESToolbarFontSizeCombo.prototype=new ESToolbarSpecialCombo;ESToolbarFontSizeCombo.prototype.GetLabel=function(){return ESLang.FontSize;};ESToolbarFontSizeCombo.prototype.CreateItems=function(A){A.FieldWidth=70;var B=ESConfig.FontSizes.split(';');for (var i=0;i<B.length;i++){var C=B[i].split('/');this._Combo.AddItem(C[0],'<font size="'+C[0]+'">'+C[1]+'</font>',C[1]);};}
var ESToolbarFontFormatCombo=function(A,B){this.Command=ESCommands.GetCommand('FontFormat');this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:ES_TOOLBARITEM_ICONTEXT;this.NormalLabel='Normal';this.PanelWidth=190;};ESToolbarFontFormatCombo.prototype=new ESToolbarSpecialCombo;ESToolbarFontFormatCombo.prototype.GetLabel=function(){return ESLang.FontFormat;};ESToolbarFontFormatCombo.prototype.CreateItems=function(A){var B=ESLang['FontFormats'].split(';');var C={p:B[0],pre:B[1],address:B[2],h1:B[3],h2:B[4],h3:B[5],h4:B[6],h5:B[7],h6:B[8],div:B[9]};var D=ESConfig.FontFormats.split(';');for (var i=0;i<D.length;i++){var E=D[i];var F=C[E];if (E=='p') this.NormalLabel=F;this._Combo.AddItem(E,'<div class="BaseFont"><'+E+'>'+F+'</'+E+'></div>',F);};};if (ESBrowserInfo.IsIE){ESToolbarFontFormatCombo.prototype.RefreshActiveItems=function(A,B){if (B==this.NormalLabel){if (A.Label!='&nbsp;') A.DeselectAll(true);}else{if (this._LastValue==B) return;A.SelectItemByLabel(B,true);};this._LastValue=B;};}
var ESToolbarStyleCombo=function(A,B){this.Command=ESCommands.GetCommand('Style');this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:ES_TOOLBARITEM_ICONTEXT;};ESToolbarStyleCombo.prototype=new ESToolbarSpecialCombo;ESToolbarStyleCombo.prototype.GetLabel=function(){return ESLang.Style;};ESToolbarStyleCombo.prototype.CreateItems=function(A){ESTools.AppendStyleSheet(A._Panel.Document,ESConfig.EditorAreaCSS);A._Panel.Document.body.className+=' ForceBaseFont';if (!ESBrowserInfo.IsGecko) A.OnBeforeClick=this.RefreshVisibleItems;for (var s in this.Command.Styles){var B=this.Command.Styles[s];var C;if (B.IsObjectElement) C=A.AddItem(s,s);else C=A.AddItem(s,B.GetOpenerTag()+s+B.GetCloserTag());C.Style=B;};};ESToolbarStyleCombo.prototype.RefreshActiveItems=function(A){A.DeselectAll();var B=this.Command.GetActiveStyles();if (B.length>0){for (var i=0;i<B.length;i++) A.SelectItem(B[i].Name);A.SetLabelById(B[0].Name);}else A.SetLabel('');};ESToolbarStyleCombo.prototype.RefreshVisibleItems=function(A){if (ESSelection.GetType()=='Control') var B=ESSelection.GetSelectedElement().tagName;for (var i in A.Items){var C=A.Items[i];if ((B&&C.Style.Element==B)||(!B&&!C.Style.IsObjectElement)) C.style.display='';else C.style.display='none';};}
var ESToolbarPanelButton=function(A,B,C,D){this.Command=ESCommands.GetCommand(A);this.Label=B?B:A;this.Tooltip=C?C:(B?B:A);this.Style=D?D:ES_TOOLBARITEM_ONLYICON;this.State=ES_UNKNOWN;this.IconPath=ESConfig.SkinPath+'toolbar/'+A.toLowerCase()+'.gif';};ESToolbarPanelButton.prototype.Click=function(e){if (this.State!=ES_TRISTATE_DISABLED){this.Command.Execute(0,this.DOMDiv.offsetHeight,this.DOMDiv);};return false;};ESToolbarPanelButton.prototype.CreateInstance=function(A){this.DOMDiv=document.createElement('div');this.DOMDiv.className='TB_Button_Off';this.DOMDiv.ESToolbarButton=this;var B='<table title="'+this.Tooltip+'" cellspacing="0" cellpadding="0" border="0">'+'<tr>';if (this.Style!=ES_TOOLBARITEM_ONLYTEXT) B+='<td class="TB_Icon"><img src="'+this.IconPath+'" width="21" height="21"></td>';if (this.Style!=ES_TOOLBARITEM_ONLYICON) B+='<td class="TB_Text" nowrap>'+this.Label+'</td>';B+='<td class="TB_ButtonArrow"><img src="'+ESConfig.SkinPath+'images/toolbar.buttonarrow.gif" width="5" height="3"></td>'+'</tr>'+'</table>';this.DOMDiv.innerHTML=B;var C=A.DOMRow.insertCell(-1);C.appendChild(this.DOMDiv);this.RefreshState();};ESToolbarPanelButton.prototype.RefreshState=ESToolbarButton.prototype.RefreshState;ESToolbarPanelButton.prototype.Enable=ESToolbarButton.prototype.Enable;ESToolbarPanelButton.prototype.Disable=ESToolbarButton.prototype.Disable;
var ESToolbarItems=new Object();ESToolbarItems.LoadedItems=new Object();ESToolbarItems.RegisterItem=function(A,B){this.LoadedItems[A]=B;};ESToolbarItems.GetItem=function(A){var B=ESToolbarItems.LoadedItems[A];if (B) return B;switch (A){case 'Source':B=new ESToolbarButton('Source',ESLang.Source,null,ES_TOOLBARITEM_ICONTEXT,true,true);break;case 'DocProps':B=new ESToolbarButton('DocProps',ESLang.DocProps);break;case 'Templates':B=new ESToolbarButton('Templates',ESLang.Templates);break;case 'Save':B=new ESToolbarButton('Save',ESLang.Save,null,null,true);break;case 'NewPage':B=new ESToolbarButton('NewPage',ESLang.NewPage,null,null,true);break;case 'Preview':B=new ESToolbarButton('Preview',ESLang.Preview,null,null,true);break;case 'About':B=new ESToolbarButton('About',ESLang.About,null,null,true);break;case 'Cut':B=new ESToolbarButton('Cut',ESLang.Cut,null,null,false,true);break;case 'Copy':B=new ESToolbarButton('Copy',ESLang.Copy,null,null,false,true);break;case 'Paste':B=new ESToolbarButton('Paste',ESLang.Paste,null,null,false,true);break;case 'PasteText':B=new ESToolbarButton('PasteText',ESLang.PasteText,null,null,false,true);break;case 'PasteWord':B=new ESToolbarButton('PasteWord',ESLang.PasteWord,null,null,false,true);break;case 'Print':B=new ESToolbarButton('Print',ESLang.Print,null,null,false,true);break;case 'SpellCheck':B=new ESToolbarButton('SpellCheck',ESLang.SpellCheck);break;case 'Undo':B=new ESToolbarButton('Undo',ESLang.Undo,null,null,false,true);break;case 'Redo':B=new ESToolbarButton('Redo',ESLang.Redo,null,null,false,true);break;case 'SelectAll':B=new ESToolbarButton('SelectAll',ESLang.SelectAll);break;case 'RemoveFormat':B=new ESToolbarButton('RemoveFormat',ESLang.RemoveFormat,null,null,false,true);break;case 'Bold':B=new ESToolbarButton('Bold',ESLang.Bold,null,null,false,true);break;case 'Italic':B=new ESToolbarButton('Italic',ESLang.Italic,null,null,false,true);break;case 'Underline':B=new ESToolbarButton('Underline',ESLang.Underline,null,null,false,true);break;case 'StrikeThrough':B=new ESToolbarButton('StrikeThrough',ESLang.StrikeThrough,null,null,false,true);break;case 'Subscript':B=new ESToolbarButton('Subscript',ESLang.Subscript,null,null,false,true);break;case 'Superscript':B=new ESToolbarButton('Superscript',ESLang.Superscript,null,null,false,true);break;case 'OrderedList':B=new ESToolbarButton('InsertOrderedList',ESLang.NumberedListLbl,ESLang.NumberedList,null,false,true);break;case 'UnorderedList':B=new ESToolbarButton('InsertUnorderedList',ESLang.BulletedListLbl,ESLang.BulletedList,null,false,true);break;case 'Outdent':B=new ESToolbarButton('Outdent',ESLang.DecreaseIndent,null,null,false,true);break;case 'Indent':B=new ESToolbarButton('Indent',ESLang.IncreaseIndent,null,null,false,true);break;case 'Link':B=new ESToolbarButton('Link',ESLang.InsertLinkLbl,ESLang.InsertLink,null,false,true);break;case 'Unlink':B=new ESToolbarButton('Unlink',ESLang.RemoveLink,null,null,false,true);break;case 'Anchor':B=new ESToolbarButton('Anchor',ESLang.Anchor);break;case 'Image':B=new ESToolbarButton('Image',ESLang.InsertImageLbl,ESLang.InsertImage);break;case 'Library':B=new ESToolbarButton('Library',ESLang.InsertImageLbl,ESLang.InsertImage);break;case 'Flash':B=new ESToolbarButton('Flash',ESLang.InsertFlashLbl,ESLang.InsertFlash);break;case 'Table':B=new ESToolbarButton('Table',ESLang.InsertTableLbl,ESLang.InsertTable);break;case 'SpecialChar':B=new ESToolbarButton('SpecialChar',ESLang.InsertSpecialCharLbl,ESLang.InsertSpecialChar);break;case 'Smiley':B=new ESToolbarButton('Smiley',ESLang.InsertSmileyLbl,ESLang.InsertSmiley);break;case 'PageBreak':B=new ESToolbarButton('PageBreak',ESLang.PageBreakLbl,ESLang.PageBreak);break;case 'UniversalKey':B=new ESToolbarButton('UniversalKey',ESLang.UniversalKeyboard);break;case 'Rule':B=new ESToolbarButton('InsertHorizontalRule',ESLang.InsertLineLbl,ESLang.InsertLine,null,false,true);break;case 'JustifyLeft':B=new ESToolbarButton('JustifyLeft',ESLang.LeftJustify,null,null,false,true);break;case 'JustifyCenter':B=new ESToolbarButton('JustifyCenter',ESLang.CenterJustify,null,null,false,true);break;case 'JustifyRight':B=new ESToolbarButton('JustifyRight',ESLang.RightJustify,null,null,false,true);break;case 'JustifyFull':B=new ESToolbarButton('JustifyFull',ESLang.BlockJustify,null,null,false,true);break;case 'Style':B=new ESToolbarStyleCombo();break;case 'FontName':B=new ESToolbarFontsCombo();break;case 'FontSize':B=new ESToolbarFontSizeCombo();break;case 'FontFormat':B=new ESToolbarFontFormatCombo();break;case 'TextColor':B=new ESToolbarPanelButton('TextColor',ESLang.TextColor);break;case 'BGColor':B=new ESToolbarPanelButton('BGColor',ESLang.BGColor);break;case 'Find':B=new ESToolbarButton('Find',ESLang.Find);break;case 'Replace':B=new ESToolbarButton('Replace',ESLang.Replace);break;case 'Form':B=new ESToolbarButton('Form',ESLang.Form);break;case 'Checkbox':B=new ESToolbarButton('Checkbox',ESLang.Checkbox);break;case 'Radio':B=new ESToolbarButton('Radio',ESLang.RadioButton);break;case 'TextField':B=new ESToolbarButton('TextField',ESLang.TextField);break;case 'Textarea':B=new ESToolbarButton('Textarea',ESLang.Textarea);break;case 'HiddenField':B=new ESToolbarButton('HiddenField',ESLang.HiddenField);break;case 'Button':B=new ESToolbarButton('Button',ESLang.Button);break;case 'Select':B=new ESToolbarButton('Select',ESLang.SelectionField);break;case 'ImageButton':B=new ESToolbarButton('ImageButton',ESLang.ImageButton);break;default:alert(ESLang.UnknownToolbarItem.replace(/%1/g,A));return null;};ESToolbarItems.LoadedItems[A]=B;return B;}
var ESToolbar=function(){this.Items=new Array();var e=this.DOMTable=document.createElement('table');e.className='TB_Toolbar';e.style.styleFloat=e.style.cssFloat=ESLang.Dir=='rtl'?'right':'left';e.cellPadding=0;e.cellSpacing=0;e.border=0;this.DOMRow=e.insertRow(-1);var A=this.DOMRow.insertCell(-1);A.className='TB_Start';A.innerHTML='<img src="'+ESConfig.SkinPath+'images/toolbar.start.gif" width="7" height="21" style="VISIBILITY: hidden" onload="this.style.visibility = \'\';">';ESToolbarSet.DOMElement.appendChild(e);};ESToolbar.prototype.AddItem=function(A){this.Items[this.Items.length]=A;A.CreateInstance(this);};ESToolbar.prototype.AddSeparator=function(){var A=this.DOMRow.insertCell(-1);A.innerHTML='<img src="'+ESConfig.SkinPath+'images/toolbar.separator.gif" width="5" height="21" style="VISIBILITY: hidden" onload="this.style.visibility = \'\';">';};ESToolbar.prototype.AddTerminator=function(){var A=this.DOMRow.insertCell(-1);A.className='TB_End';A.innerHTML='<img src="'+ESConfig.SkinPath+'images/toolbar.end.gif" width="12" height="21" style="VISIBILITY: hidden" onload="this.style.visibility = \'\';">';};
var ESToolbarBreak=function(){var A=document.createElement('div');A.className='TB_Break';A.style.clear=ESLang.Dir=='rtl'?'left':'right';ESToolbarSet.DOMElement.appendChild(A);}
var ESToolbarSet=ES.ToolbarSet=new Object();document.getElementById('ExpandHandle').title=ESLang.ToolbarExpand;document.getElementById('CollapseHandle').title=ESLang.ToolbarCollapse;ESToolbarSet.Toolbars=new Array();ESToolbarSet.ItemsWysiwygOnly=new Array();ESToolbarSet.ItemsContextSensitive=new Array();ESToolbarSet.Expand=function(){document.getElementById('Collapsed').style.display='none';document.getElementById('Expanded').style.display='';if (!ESBrowserInfo.IsIE){window.setTimeout("window.onresize()",1);};};ESToolbarSet.Collapse=function(){document.getElementById('Collapsed').style.display='';document.getElementById('Expanded').style.display='none';if (!ESBrowserInfo.IsIE){window.setTimeout("window.onresize()",1);};};ESToolbarSet.Restart=function(){if (!ESConfig.ToolbarCanCollapse||ESConfig.ToolbarStartExpanded) this.Expand();else this.Collapse();document.getElementById('CollapseHandle').style.display=ESConfig.ToolbarCanCollapse?'':'none';};ESToolbarSet.Load=function(A){this.DOMElement=document.getElementById('eToolbar');var B=ESConfig.ToolbarSets[A];if (!B){alert(ESLang.UnknownToolbarSet.replace(/%1/g,A));return;};this.Toolbars=new Array();for (var x=0;x<B.length;x++){var C=B[x];var D;if (typeof(C)=='string'){if (C=='/') D=new ESToolbarBreak();}else{D=new ESToolbar();for (var j=0;j<C.length;j++){var E=C[j];if (E=='-') D.AddSeparator();else{var F=ESToolbarItems.GetItem(E);if (F){D.AddItem(F);if (!F.SourceView) this.ItemsWysiwygOnly[this.ItemsWysiwygOnly.length]=F;if (F.ContextSensitive) this.ItemsContextSensitive[this.ItemsContextSensitive.length]=F;};};};D.AddTerminator();};this.Toolbars[this.Toolbars.length]=D;};};ESToolbarSet.RefreshModeState=function(){if (ES.EditMode==ES_EDITMODE_WYSIWYG){for (var i=0;i<ESToolbarSet.ItemsWysiwygOnly.length;i++) ESToolbarSet.ItemsWysiwygOnly[i].Enable();ESToolbarSet.RefreshItemsState();}else{ESToolbarSet.RefreshItemsState();for (var i=0;i<ESToolbarSet.ItemsWysiwygOnly.length;i++) ESToolbarSet.ItemsWysiwygOnly[i].Disable();};};ESToolbarSet.RefreshItemsState=function(){for (var i=0;i<ESToolbarSet.ItemsContextSensitive.length;i++) ESToolbarSet.ItemsContextSensitive[i].RefreshState();};
var ESDialog=new Object();ESDialog.OpenDialog=function(A,B,C,D,E,F,G,H){var I=new Object();I.Title=B;I.Page=C;I.Editor=window;I.CustomValue=F;var J=ESConfig.BasePath+'esdialog.html';this.Show(I,A,J,D,E,G,H);};
ESDialog.Show=function(A,B,C,D,E,F){if (!F) F=window;this.IsOpened=true;F.showModalDialog(C,A,"dialogWidth:"+D+"px;dialogHeight:"+E+"px;help:no;scroll:no;status:no");this.IsOpened=false;};
var ESContextMenuItem=function(A,B,C,D){this.ContextMenu=A;this.Command=ESCommands.GetCommand(B);this.Label=C?C:B;this.HasIcon=D?true:false;};function ESContextMenuItem_OnMouseOver(){if (this.className!='CM_Disabled') this.className='CM_Over';};function ESContextMenuItem_OnMouseOut(){if (this.className!='CM_Disabled') this.className='CM_Option';};function ESContextMenuItem_OnClick(){if (this.className!='CM_Disabled'){this.ESContextMenuItem.ContextMenu.Hide();this.ESContextMenuItem.Command.Execute();};return false;};ESContextMenuItem.prototype.CreateTableRow=function(A){this._Row=A.insertRow(-1);this._Row.className='CM_Disabled';this._Row.ESContextMenuItem=this;this._Row.onmouseover=ESContextMenuItem_OnMouseOver;this._Row.onmouseout=ESContextMenuItem_OnMouseOut;this._Row.onclick=ESContextMenuItem_OnClick;var B=this._Row.insertCell(-1);B.className='CM_Icon';if (this.HasIcon) B.innerHTML='<img alt="" src="'+ESConfig.SkinPath+'toolbar/'+this.Command.Name.toLowerCase()+'.gif" width="21" height="20">';B=this._Row.insertCell(-1);B.className='CM_Label';B.noWrap=true;B.innerHTML=this.Label;};ESContextMenuItem.prototype.SetVisible=function(A){this._Row.style.display=A?'':'none';};ESContextMenuItem.prototype.RefreshState=function(){switch (this.Command.GetState()){case ES_TRISTATE_ON:case ES_TRISTATE_OFF:this._Row.className='CM_Option';break;default:this._Row.className='CM_Disabled';break;};};
var ESContextMenuSeparator=function(){};ESContextMenuSeparator.prototype.CreateTableRow=function(A){this._Row=A.insertRow(-1);this._Row.className='CM_Separator';var B=this._Row.insertCell(-1);B.className='CM_Icon';var C=A.ownerDocument||A.document;B=this._Row.insertCell(-1);B.className='CM_Label';B.appendChild(C.createElement('DIV')).className='CM_Separator_Line';};ESContextMenuSeparator.prototype.SetVisible=function(A){this._Row.style.display=A?'':'none';};ESContextMenuSeparator.prototype.RefreshState=function(){};
var ESContextMenuGroup=function(A,B,C,D,E){this.IsVisible=true;this.Items=new Array();if (A) this.Add(new ESContextMenuSeparator());if (B&&C&&D) this.Add(new ESContextMenuItem(B,C,D,E));this.ValidationFunction=null;};ESContextMenuGroup.prototype.Add=function(A){this.Items[this.Items.length]=A;};ESContextMenuGroup.prototype.CreateTableRows=function(A){for (var i=0;i<this.Items.length;i++){this.Items[i].CreateTableRow(A);};};ESContextMenuGroup.prototype.SetVisible=function(A){for (var i=0;i<this.Items.length;i++){this.Items[i].SetVisible(A);};this.IsVisible=A;};ESContextMenuGroup.prototype.RefreshState=function(){if (!this.IsVisible) return;for (var i=0;i<this.Items.length;i++){this.Items[i].RefreshState();};}
var ESContextMenu=new Object();ESContextMenu._Panel=new ESPanel(ESBrowserInfo.IsIE?window:window.parent);ESContextMenu._Panel.PanelDiv.className='CM_ContextMenu';ESContextMenu._Panel.AppendStyleSheet(ESConfig.SkinPath+'es_contextmenu.css');ESContextMenu._Panel.IsContextMenu=true;ESContextMenu._Document=ESContextMenu._Panel.Document;ESContextMenu._IsLoaded=false;ESContextMenu.Show=function(x,y){if (!this._IsLoaded) this.Reload();this.RefreshState();if (!ESBrowserInfo.IsIE){var A=ESTools.GetElementPosition(ES.EditorWindow.frameElement,this._Panel._Window);x+=A.X;y+=A.Y;};this._Panel.Show(x,y);};ESContextMenu.Hide=function(){this._Panel.Hide();};ESContextMenu.Reload=function(){var A=this._Document.createElement('TABLE');A.cellSpacing=0;A.cellPadding=0;this._Panel.PanelDiv.appendChild(A);this.Groups=new Object();for (var i=0;i<ESConfig.ContextMenu.length;i++){var B=ESConfig.ContextMenu[i];this.Groups[B]=this._GetGroup(B);this.Groups[B].CreateTableRows(A);};ESTools.DisableSelection(this._Panel.Document.body);this._IsLoaded=true;};ESContextMenu._GetGroup=function(A){var B;switch (A){case 'Generic':B=new ESContextMenuGroup();B.Add(new ESContextMenuItem(this,'Cut',ESLang.Cut,true));B.Add(new ESContextMenuItem(this,'Copy',ESLang.Copy,true));B.Add(new ESContextMenuItem(this,'Paste',ESLang.Paste,true));break;case 'Link':B=new ESContextMenuGroup();B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'Link',ESLang.EditLink,true));B.Add(new ESContextMenuItem(this,'Unlink',ESLang.RemoveLink,true));break;case 'TableCell':B=new ESContextMenuGroup();B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'TableInsertRow',ESLang.InsertRow,true));B.Add(new ESContextMenuItem(this,'TableDeleteRows',ESLang.DeleteRows,true));B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'TableInsertColumn',ESLang.InsertColumn,true));B.Add(new ESContextMenuItem(this,'TableDeleteColumns',ESLang.DeleteColumns,true));B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'TableInsertCell',ESLang.InsertCell,true));B.Add(new ESContextMenuItem(this,'TableDeleteCells',ESLang.DeleteCells,true));B.Add(new ESContextMenuItem(this,'TableMergeCells',ESLang.MergeCells,true));B.Add(new ESContextMenuItem(this,'TableSplitCell',ESLang.SplitCell,true));B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'TableDelete',ESLang.TableDelete,false));B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'TableCellProp',ESLang.CellProperties,true));B.Add(new ESContextMenuItem(this,'TableProp',ESLang.TableProperties,true));break;case 'Table':B=new ESContextMenuGroup();B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'TableDelete',ESLang.TableDelete,false));B.Add(new ESContextMenuSeparator());B.Add(new ESContextMenuItem(this,'Table',ESLang.TableProperties,true));break;case 'Image':return new ESContextMenuGroup(true,this,'Image',ESLang.ImageProperties,true);case 'Flash':return new ESContextMenuGroup(true,this,'Flash',ESLang.FlashProperties,true);case 'Form':return new ESContextMenuGroup(true,this,'Form',ESLang.FormProp,true);case 'Checkbox':return new ESContextMenuGroup(true,this,'Checkbox',ESLang.CheckboxProp,true);case 'Radio':return new ESContextMenuGroup(true,this,'Radio',ESLang.RadioButtonProp,true);case 'TextField':return new ESContextMenuGroup(true,this,'TextField',ESLang.TextFieldProp,true);case 'HiddenField':return new ESContextMenuGroup(true,this,'HiddenField',ESLang.HiddenFieldProp,true);case 'ImageButton':return new ESContextMenuGroup(true,this,'ImageButton',ESLang.ImageButtonProp,true);case 'Button':return new ESContextMenuGroup(true,this,'Button',ESLang.ButtonProp,true);case 'Select':return new ESContextMenuGroup(true,this,'Select',ESLang.SelectionFieldProp,true);case 'Textarea':return new ESContextMenuGroup(true,this,'Textarea',ESLang.TextareaProp,true);case 'BulletedList':return new ESContextMenuGroup(true,this,'BulletedList',ESLang.BulletedListProp,true);case 'NumberedList':return new ESContextMenuGroup(true,this,'NumberedList',ESLang.NumberedListProp,true);case 'Anchor':return new ESContextMenuGroup(true,this,'Anchor',ESLang.AnchorProp,true);};return B;};ESContextMenu.RefreshState=function(){var A=ESSelection.GetSelectedElement();var B;if (A) B=A.tagName;if (this.Groups['Link'])			this.Groups['Link'].SetVisible(ES.GetNamedCommandState('Unlink')!=ES_TRISTATE_DISABLED);if (this.Groups['TableCell'])		this.Groups['TableCell'].SetVisible(B!='TABLE'&&ESSelection.HasAncestorNode('TABLE'));if (this.Groups['Table'])			this.Groups['Table'].SetVisible(B=='TABLE');if (this.Groups['Image'])			this.Groups['Image'].SetVisible(B=='IMG'&&!A.getAttribute('_esfakelement'));if (this.Groups['Flash'])			this.Groups['Flash'].SetVisible(B=='IMG'&&A.getAttribute('_esflash'));if (this.Groups['Anchor'])		this.Groups['Anchor'].SetVisible(B=='IMG'&&A.getAttribute('_esanchor'));if (this.Groups['BulletedList'])	this.Groups['BulletedList'].SetVisible(ESSelection.HasAncestorNode('UL'));if (this.Groups['NumberedList'])	this.Groups['NumberedList'].SetVisible(ESSelection.HasAncestorNode('OL'));if (this.Groups['Select'])		this.Groups['Select'].SetVisible(B=='SELECT');if (this.Groups['Textarea'])		this.Groups['Textarea'].SetVisible(B=='TEXTAREA');if (this.Groups['Form'])			this.Groups['Form'].SetVisible(ESSelection.HasAncestorNode('FORM'));if (this.Groups['Checkbox'])		this.Groups['Checkbox'].SetVisible(B=='INPUT'&&A.type=='checkbox');if (this.Groups['Radio'])			this.Groups['Radio'].SetVisible(B=='INPUT'&&A.type=='radio');if (this.Groups['TextField'])		this.Groups['TextField'].SetVisible(B=='INPUT'&&(A.type=='text'||A.type=='password'));if (this.Groups['HiddenField'])	this.Groups['HiddenField'].SetVisible(B=='INPUT'&&A.type=='hidden');if (this.Groups['ImageButton'])	this.Groups['ImageButton'].SetVisible(B=='INPUT'&&A.type=='image');if (this.Groups['Button'])		this.Groups['Button'].SetVisible(B=='INPUT'&&(A.type=='button'||A.type=='submit'||A.type=='reset'));for (var o in this.Groups){this.Groups[o].RefreshState();};};
if (!ESConfig.PluginsPath.endsWith('/')) ESConfig.PluginsPath+='/';var ESPlugin=function(A,B,C){this.Name=A;this.BasePath=C?C:ESConfig.PluginsPath;this.Path=this.BasePath+A+'/';if (!B||B.length==0) this.AvailableLangs=new Array();else this.AvailableLangs=B.split(',');};ESPlugin.prototype.Load=function(){if (this.AvailableLangs.length>0){var A;if (this.AvailableLangs.indexOf(ESLanguageManager.ActiveLanguage.Code)>=0) A=ESLanguageManager.ActiveLanguage.Code;else A=this.AvailableLangs[0];ESScriptLoader.AddScript(this.Path+'lang/'+A+'.js');};ESScriptLoader.AddScript(this.Path+'esplugin.js');}
var ESPlugins=ES.Plugins=new Object();ESPlugins.ItemsCount=0;ESPlugins.Loaded=false;ESPlugins.Items=new Object();for (var i=0;i<ESConfig.Plugins.Items.length;i++){var oItem=ESConfig.Plugins.Items[i];ESPlugins.Items[oItem[0]]=new ESPlugin(oItem[0],oItem[1],oItem[2]);ESPlugins.ItemsCount++;};ESPlugins.Load=function(){for (var s in this.Items) this.Items[s].Load();this.Loaded=true;ESPlugins.Load=null;}
if (ESLang&&window.document.dir.toLowerCase()!=ESLang.Dir.toLowerCase()) window.document.dir=ESLang.Dir;if (ESConfig.ForcePasteAsPlainText||ESConfig.AutoDetectPasteFromWord) ES.Events.AttachEvent("OnPaste",ES.Paste);if (ESPlugins.ItemsCount>0){ESScriptLoader.OnEmpty=CompleteLoading;ESPlugins.Load();}else CompleteLoading();function CompleteLoading(){ESToolbarSet.Name=ESURLParams['Toolbar']||'Default';ESToolbarSet.Load(ESToolbarSet.Name);ESToolbarSet.Restart();ES.AttachToOnSelectionChange(ESToolbarSet.RefreshItemsState);ESTools.DisableSelection(document.body);ES.SetStatus(ES_STATUS_COMPLETE);if (typeof(window.parent.ESeditor_OnComplete)=='function') window.parent.ESeditor_OnComplete(ES);}
