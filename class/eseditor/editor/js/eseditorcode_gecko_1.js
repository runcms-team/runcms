/**
*
* @ Copyright: Copyright (C) Farsus Design. All rights reserved. 
* @ Package: ScarPoX / shortterm SPX
* @ Subpackage: RUNCMS 
* @ License: http://www.gnu.org/copyleft/gpl.html GNU/GPL
* @ Subpackage: ScarPoX ESeditor
* @ ESeditor is based on FCKeditor by Frederico Caldeira Knabben
* @ original authers website http://www.fckeditor.net
*
*/

var ESDebug=new Object();if (ESConfig.Debug){ESDebug.Output=function(A,B,C){if (!ESConfig.Debug) return;if (!C&&A!=null&&isNaN(A)) A=A.replace(/</g,"&lt;");if (!this.DebugWindow||this.DebugWindow.closed) this.DebugWindow=window.open(ESConfig.BasePath+'esdebug.html','ESeditorDebug','menubar=no,scrollbars=no,resizable=yes,location=no,toolbar=no,width=600,height=500',true);if (this.DebugWindow.Output){try{this.DebugWindow.Output(A,B);}catch (e) {};};};ESDebug.OutputObject=function(A,B){var C;if (A!=null){C='Properties of: '+A+'</b><blockquote>';for (var D in A){var E=A[D]?A[D]+'':'[null]';try{C+='<b>'+D+'</b> : '+E.replace(/</g,'&lt;')+'<br>';}catch (e){C+='<b>'+D+'</b> : ['+typeof(A[D])+']<br>';};};C+='</blockquote><b>';} else C='OutputObject : Object is "null".';ESDebug.Output(C,B,true);};}else{ESDebug.Output=function() {};ESDebug.OutputObject=function() {};}
var ESTools=new Object();ESTools.GetLinkedFieldValue=function(){return ES.LinkedField.value;};ESTools.AttachToLinkedFieldFormSubmit=function(A){var B=ES.LinkedField.form;if (!B) return;if (ESBrowserInfo.IsIE) B.attachEvent("onsubmit",A);else B.addEventListener('submit',A,true);if (!B.updateESeditor) B.updateESeditor=new Array();B.updateESeditor[B.updateESeditor.length]=A;if (!B.originalSubmit&&(typeof(B.submit)=='function'||(!B.submit.tagName&&!B.submit.length))){B.originalSubmit=B.submit;B.submit=ESTools_SubmitReplacer;};};function ESTools_SubmitReplacer(){if (this.updateESeditor){for (var i=0;i<this.updateESeditor.length;i++) this.updateESeditor[i]();};this.originalSubmit();};ESTools.AddSelectOption=function(A,B,C,D){var E=A.createElement("OPTION");E.text=C;E.value=D;B.options.add(E);return E;};ESTools.HTMLEncode=function(A){if (!A) return '';A=A.replace(/&/g,"&amp;");A=A.replace(/"/g,"&quot;");A=A.replace(/</g,"&lt;");A=A.replace(/>/g,"&gt;");A=A.replace(/'/g,"&#39;");return A;};ESTools.GetElementPosition=function(A,B){var c={ X:0,Y:0 };var C=B||window;while (A){c.X+=A.offsetLeft;c.Y+=A.offsetTop;if (A.offsetParent==null){var D=ESTools.GetElementWindow(A);if (D!=C) A=D.frameElement;else break;}else A=A.offsetParent;};return c;};ESTools.GetElementAscensor=function(A,B){var e=A;var C=","+B.toUpperCase()+",";while (e){if (C.indexOf(","+e.nodeName.toUpperCase()+",")!=-1) return e;e=e.parentNode;};return null;};ESTools.Pause=function(A){var B=new Date();while (true){var C=new Date();if (A<C-B) return;};};ESTools.ConvertStyleSizeToHtml=function(A){return A.endsWith('%')?A:parseInt(A);};ESTools.ConvertHtmlSizeToStyle=function(A){return A.endsWith('%')?A:(A+'px');};ESTools.GetElementWindow=function(A){var B=A.ownerDocument||A.document;if (ESBrowserInfo.IsSafari&&!B.parentWindow) ESTools._FixDocumentParentWindow(window.top);return B.parentWindow||B.defaultView;};ESTools._FixDocumentParentWindow=function(A){A.document.parentWindow=A;for (var i=0;i<A.frames.length;i++) ESTools._FixDocumentParentWindow(A.frames[i]);};ESTools.CancelEvent=function(e){return false;};
var GECKO_BOGUS='<br _moz_editor_bogus_node="TRUE">';ESTools.AppendStyleSheet=function(A,B){var e=A.createElement('LINK');e.rel='stylesheet';e.type='text/css';e.href=B;A.getElementsByTagName("HEAD")[0].appendChild(e);return e;};ESTools.ClearElementAttributes=function(A){for (var i=0;i<A.attributes.length;i++){A.removeAttribute(A.attributes[i].name,0);};};ESTools.GetAllChildrenIds=function(A){var B=new Array();var C=function(parent){for (var i=0;i<parent.childNodes.length;i++){var D=parent.childNodes[i].id;if (D&&D.length>0) B[B.length]=D;C(parent.childNodes[i]);};};C(A);return B;};ESTools.RemoveOuterTags=function(e){var A=e.ownerDocument.createDocumentFragment();for (var i=0;i<e.childNodes.length;i++) A.appendChild(e.childNodes[i]);e.parentNode.replaceChild(A,e);};ESTools.CreateXmlObject=function(A){switch (A){case 'XmlHttp':return new XMLHttpRequest();case 'DOMDocument':return document.implementation.createDocument('','',null);};return null;};ESTools.DisableSelection=function(A){A.style.MozUserSelect='none';};
var ESRegexLib=new Object();ESRegexLib.AposEntity=/&apos;/gi;ESRegexLib.ObjectElements=/^(?:IMG|TABLE|TR|TD|TH|INPUT|SELECT|TEXTAREA|HR|OBJECT|A|UL|OL|LI)$/i;ESRegexLib.BlockElements=/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TD|TH)$/i;ESRegexLib.EmptyElements=/^(?:BASE|META|LINK|HR|BR|PARAM|IMG|AREA|INPUT)$/i;ESRegexLib.NamedCommands=/^(?:Cut|Copy|Paste|Print|SelectAll|RemoveFormat|Unlink|Undo|Redo|Bold|Italic|Underline|StrikeThrough|Subscript|Superscript|JustifyLeft|JustifyCenter|JustifyRight|JustifyFull|Outdent|Indent|InsertOrderedList|InsertUnorderedList|InsertHorizontalRule)$/i;ESRegexLib.BodyContents=/([\s\S]*\<body[^\>]*\>)([\s\S]*)(\<\/body\>[\s\S]*)/i;ESRegexLib.ToReplace=/___estoreplace:([\w]+)/ig;ESRegexLib.MetaHttpEquiv=/http-equiv\s*=\s*["']?([^"' ]+)/i;ESRegexLib.HasBaseTag=/<base /i;ESRegexLib.HeadOpener=/<head\s?[^>]*>/i;ESRegexLib.HeadCloser=/<\/head\s*>/i;ESRegexLib.TableBorderClass=/\s*ES__ShowTableBorders\s*/;ESRegexLib.ElementName=/^[A-Za-z_:][\w.\-:]*$/;ESRegexLib.ForceSimpleAmpersand=/___ESAmp___/g;ESRegexLib.SpaceNoClose=/\/>/g;ESRegexLib.EmptyParagraph=/^<(p|div)>\s*<\/\1>$/i;ESRegexLib.TagBody=/></;ESRegexLib.StrongOpener=/<STRONG([ \>])/gi;ESRegexLib.StrongCloser=/<\/STRONG>/gi;ESRegexLib.EmOpener=/<EM([ \>])/gi;ESRegexLib.EmCloser=/<\/EM>/gi;ESRegexLib.GeckoEntitiesMarker=/#\?-\:/g;ESRegexLib.ProtectUrlsAApo=/(<a\s.*?href=)("|')(.+?)\2/gi;ESRegexLib.ProtectUrlsANoApo=/(<a\s.*?href=)([^"'][^ >]+)/gi;ESRegexLib.ProtectUrlsImgApo=/(<img\s.*?src=)("|')(.+?)\2/gi;ESRegexLib.ProtectUrlsImgNoApo=/(<img\s.*?src=)([^"'][^ >]+)/gi;
ESLanguageManager.GetActiveLanguage=function(){if (ESConfig.AutoDetectLanguage){var A;if (navigator.userLanguage) A=navigator.userLanguage.toLowerCase();else if (navigator.language) A=navigator.language.toLowerCase();else{return ESConfig.DefaultLanguage;};if (A.length>=5){A=A.substr(0,5);if (this.AvailableLanguages[A]) return A;};if (A.length>=2){A=A.substr(0,2);if (this.AvailableLanguages[A]) return A;};};return this.DefaultLanguage;};ESLanguageManager.TranslateElements=function(A,B,C){var e=A.getElementsByTagName(B);for (var i=0;i<e.length;i++){var D=e[i].getAttribute('esLang');if (D){var s=ESLang[D];if (s) eval('e[i].'+C+' = s');};};};ESLanguageManager.TranslatePage=function(A){this.TranslateElements(A,'INPUT','value');this.TranslateElements(A,'SPAN','innerHTML');this.TranslateElements(A,'LABEL','innerHTML');this.TranslateElements(A,'OPTION','innerHTML');};if (ESLanguageManager.AvailableLanguages[ESConfig.DefaultLanguage]) ESLanguageManager.DefaultLanguage=ESConfig.DefaultLanguage;else ESLanguageManager.DefaultLanguage='en';ESLanguageManager.ActiveLanguage=new Object();ESLanguageManager.ActiveLanguage.Code=ESLanguageManager.GetActiveLanguage();ESLanguageManager.ActiveLanguage.Name=ESLanguageManager.AvailableLanguages[ESLanguageManager.ActiveLanguage.Code];ES.Language=ESLanguageManager;LoadLanguageFile();
var ESEvents;if (!(ESEvents=NS.ESEvents)){ESEvents=NS.ESEvents=function(A){this.Owner=A;this.RegisteredEvents=new Object();};ESEvents.prototype.AttachEvent=function(A,B){if (!this.RegisteredEvents[A]) this.RegisteredEvents[A]=new Array();this.RegisteredEvents[A][this.RegisteredEvents[A].length]=B;};ESEvents.prototype.FireEvent=function(A,B){var C=true;var D=this.RegisteredEvents[A];if (D){for (var i=0;i<D.length;i++) C=(D[i](this.Owner,B)&&C);};return C;};}
var ESXHtmlEntities=new Object();if (ESConfig.ProcessHTMLEntities){ESXHtmlEntities.Entities={' ':'nbsp','¡':'iexcl','¢':'cent','£':'pound','¤':'curren','¥':'yen','¦':'brvbar','§':'sect','¨':'uml','©':'copy','ª':'ordf','«':'laquo','¬':'not','­':'shy','®':'reg','¯':'macr','°':'deg','±':'plusmn','²':'sup2','³':'sup3','´':'acute','µ':'micro','¶':'para','·':'middot','¸':'cedil','¹':'sup1','º':'ordm','»':'raquo','¼':'frac14','½':'frac12','¾':'frac34','¿':'iquest','×':'times','÷':'divide','ƒ':'fnof','•':'bull','…':'hellip','′':'prime','″':'Prime','‾':'oline','⁄':'frasl','℘':'weierp','ℑ':'image','ℜ':'real','™':'trade','ℵ':'alefsym','←':'larr','↑':'uarr','→':'rarr','↓':'darr','↔':'harr','↵':'crarr','⇐':'lArr','⇑':'uArr','⇒':'rArr','⇓':'dArr','⇔':'hArr','∀':'forall','∂':'part','∃':'exist','∅':'empty','∇':'nabla','∈':'isin','∉':'notin','∋':'ni','∏':'prod','∑':'sum','−':'minus','∗':'lowast','√':'radic','∝':'prop','∞':'infin','∠':'ang','∧':'and','∨':'or','∩':'cap','∪':'cup','∫':'int','∴':'there4','∼':'sim','≅':'cong','≈':'asymp','≠':'ne','≡':'equiv','≤':'le','≥':'ge','⊂':'sub','⊃':'sup','⊄':'nsub','⊆':'sube','⊇':'supe','⊕':'oplus','⊗':'otimes','⊥':'perp','⋅':'sdot','◊':'loz','♠':'spades','♣':'clubs','♥':'hearts','♦':'diams','"':'quot','ˆ':'circ','˜':'tilde',' ':'ensp',' ':'emsp',' ':'thinsp','‌':'zwnj','‍':'zwj','‎':'lrm','‏':'rlm','–':'ndash','—':'mdash','‘':'lsquo','’':'rsquo','‚':'sbquo','“':'ldquo','”':'rdquo','„':'bdquo','†':'dagger','‡':'Dagger','‰':'permil','‹':'lsaquo','›':'rsaquo','€':'euro'};ESXHtmlEntities.Chars='';for (var e in ESXHtmlEntities.Entities) ESXHtmlEntities.Chars+=e;if (ESConfig.IncludeLatinEntities){var oEntities={'À':'Agrave','Á':'Aacute','Â':'Acirc','Ã':'Atilde','Ä':'Auml','Å':'Aring','Æ':'AElig','Ç':'Ccedil','È':'Egrave','É':'Eacute','Ê':'Ecirc','Ë':'Euml','Ì':'Igrave','Í':'Iacute','Î':'Icirc','Ï':'Iuml','Ð':'ETH','Ñ':'Ntilde','Ò':'Ograve','Ó':'Oacute','Ô':'Ocirc','Õ':'Otilde','Ö':'Ouml','Ø':'Oslash','Ù':'Ugrave','Ú':'Uacute','Û':'Ucirc','Ü':'Uuml','Ý':'Yacute','Þ':'THORN','ß':'szlig','à':'agrave','á':'aacute','â':'acirc','ã':'atilde','ä':'auml','å':'aring','æ':'aelig','ç':'ccedil','è':'egrave','é':'eacute','ê':'ecirc','ë':'euml','ì':'igrave','í':'iacute','î':'icirc','ï':'iuml','ð':'eth','ñ':'ntilde','ò':'ograve','ó':'oacute','ô':'ocirc','õ':'otilde','ö':'ouml','ø':'oslash','ù':'ugrave','ú':'uacute','û':'ucirc','ü':'uuml','ý':'yacute','þ':'thorn','ÿ':'yuml','Œ':'OElig','œ':'oelig','Š':'Scaron','š':'scaron','Ÿ':'Yuml'};for (var e in oEntities){ESXHtmlEntities.Entities[e]=oEntities[e];ESXHtmlEntities.Chars+=e;};oEntities=null;};if (ESConfig.IncludeGreekEntities){var oEntities={'Α':'Alpha','Β':'Beta','Γ':'Gamma','Δ':'Delta','Ε':'Epsilon','Ζ':'Zeta','Η':'Eta','Θ':'Theta','Ι':'Iota','Κ':'Kappa','Λ':'Lambda','Μ':'Mu','Ν':'Nu','Ξ':'Xi','Ο':'Omicron','Π':'Pi','Ρ':'Rho','Σ':'Sigma','Τ':'Tau','Υ':'Upsilon','Φ':'Phi','Χ':'Chi','Ψ':'Psi','Ω':'Omega','α':'alpha','β':'beta','γ':'gamma','δ':'delta','ε':'epsilon','ζ':'zeta','η':'eta','θ':'theta','ι':'iota','κ':'kappa','λ':'lambda','μ':'mu','ν':'nu','ξ':'xi','ο':'omicron','π':'pi','ρ':'rho','ς':'sigmaf','σ':'sigma','τ':'tau','υ':'upsilon','φ':'phi','χ':'chi','ψ':'psi','ω':'omega'};for (var e in oEntities){ESXHtmlEntities.Entities[e]=oEntities[e];ESXHtmlEntities.Chars+=e;};oEntities=null;};ESXHtmlEntities.EntitiesRegex=new RegExp('['+ESXHtmlEntities.Chars+']|[^'+ESXHtmlEntities.Chars+']+','g');}else{ESXHtmlEntities.Entities={ ' ':'nbsp' };ESXHtmlEntities.EntitiesRegex=/[ ]|[^ ]+/g;}
var ESXHtml=new Object();ESXHtml.CurrentJobNum=0;ESXHtml.GetXHTML=function(A,B,C){ESXHtml.SpecialBlocks=new Array();this.XML=ESTools.CreateXmlObject('DOMDocument');this.MainNode=this.XML.appendChild(this.XML.createElement('xhtml'));ESXHtml.CurrentJobNum++;if (B) this._AppendNode(this.MainNode,A);else this._AppendChildNodes(this.MainNode,A,false);var D=this._GetMainXmlString();D=D.substr(7,D.length-15).trim();if (ESBrowserInfo.IsGecko) D=D.replace(/<br\/>$/,'');D=D.replace(ESRegexLib.SpaceNoClose,' />');if (ESConfig.ForceSimpleAmpersand) D=D.replace(ESRegexLib.ForceSimpleAmpersand,'&');if (C) D=ESCodeFormatter.Format(D);for (var i=0;i<ESXHtml.SpecialBlocks.length;i++){var E=new RegExp('___ESsi___'+i);D=D.replace(E,ESXHtml.SpecialBlocks[i]);};this.XML=null;return D};ESXHtml._AppendAttribute=function(A,B,C){try{var D=this.XML.createAttribute(B);D.value=C?C:'';A.attributes.setNamedItem(D);}catch (e){};};ESXHtml._AppendChildNodes=function(A,B,C){var D=0;var E=B.firstChild;while (E){if (this._AppendNode(A,E)) D++;E=E.nextSibling;};if (D==0){if (C&&ESConfig.FillEmptyBlocks){this._AppendEntity(A,'nbsp');return;};if (!ESRegexLib.EmptyElements.test(B.nodeName)) A.appendChild(this.XML.createTextNode(''));};};ESXHtml._AppendNode=function(A,B){if (!B) return;switch (B.nodeType){case 1:if (B.getAttribute('_esfakelement')) return ESXHtml._AppendNode(A,ES.GetRealElement(B));if (ESBrowserInfo.IsGecko&&B.hasAttribute('_moz_editor_bogus_node')) return false;if (B.getAttribute('_esdelete')) return false;var C=B.nodeName;if (ESBrowserInfo.IsIE&&B.scopeName&&B.scopeName!='HTML') C=B.scopeName+':'+C;if (!ESRegexLib.ElementName.test(C)) return false;C=C.toLowerCase();if (ESBrowserInfo.IsGecko&&C=='br'&&B.hasAttribute('type')&&B.getAttribute('type',2)=='_moz') return false;if (B._esxhtmljob&&B._esxhtmljob==ESXHtml.CurrentJobNum) return false;var D=this._CreateNode(C);ESXHtml._AppendAttributes(A,B,D,C);B._esxhtmljob=ESXHtml.CurrentJobNum;var E=ESXHtml.TagProcessors[C];if (E){D=E(D,B);if (!D) break;}else this._AppendChildNodes(D,B,ESRegexLib.BlockElements.test(C));A.appendChild(D);break;case 3:this._AppendTextNode(A,B.nodeValue.replaceNewLineChars(' '));break;case 8:try { A.appendChild(this.XML.createComment(B.nodeValue));}catch (e) { /* Do nothing... probably this is a wrong format comment. */};break;default:A.appendChild(this.XML.createComment("Element not supported - Type: "+B.nodeType+" Name: "+B.nodeName));break;};return true;};if (ESConfig.ForceStrongEm){ESXHtml._CreateNode=function(A){switch (A){case 'b':A='strong';break;case 'i':A='em';break;};return this.XML.createElement(A);};}else{ESXHtml._CreateNode=function(A){return this.XML.createElement(A);};};ESXHtml._AppendSpecialItem=function(A){return '___ESsi___'+ESXHtml.SpecialBlocks.addItem(A);};ESXHtml._AppendTextNode=function(A,B){var C=B.match(ESXHtmlEntities.EntitiesRegex);if (C){for (var i=0;i<C.length;i++){if (C[i].length==1){var D=ESXHtmlEntities.Entities[C[i]];if (D!=null){this._AppendEntity(A,D);continue;};};A.appendChild(this.XML.createTextNode(C[i]));};};};ESXHtml.TagProcessors=new Object();ESXHtml.TagProcessors['img']=function(A,B){if (!A.attributes.getNamedItem('alt')) ESXHtml._AppendAttribute(A,'alt','');var C=B.getAttribute('_essavedurl');if (C&&C.length>0) ESXHtml._AppendAttribute(A,'src',C);return A;};ESXHtml.TagProcessors['a']=function(A,B){var C=B.getAttribute('_essavedurl');if (C&&C.length>0) ESXHtml._AppendAttribute(A,'href',C);ESXHtml._AppendChildNodes(A,B,false);return A;};ESXHtml.TagProcessors['script']=function(A,B){if (!A.attributes.getNamedItem('type')) ESXHtml._AppendAttribute(A,'type','text/javascript');A.appendChild(ESXHtml.XML.createTextNode(ESXHtml._AppendSpecialItem(B.text)));return A;};ESXHtml.TagProcessors['style']=function(A,B){if (B.getAttribute('_estemp')) return null;if (!A.attributes.getNamedItem('type')) ESXHtml._AppendAttribute(A,'type','text/css');A.appendChild(ESXHtml.XML.createTextNode(ESXHtml._AppendSpecialItem(B.innerHTML)));return A;};ESXHtml.TagProcessors['title']=function(A,B){A.appendChild(ESXHtml.XML.createTextNode(ES.EditorDocument.title));return A;};ESXHtml.TagProcessors['base']=function(A,B){if (B.getAttribute('_estemp')) return null;return A;};ESXHtml.TagProcessors['link']=function(A,B){if (B.getAttribute('_estemp')) return null;return A;};ESXHtml.TagProcessors['table']=function(A,B){var C=A.attributes.getNamedItem('class');if (C&&ESRegexLib.TableBorderClass.test(C.nodeValue)){var D=C.nodeValue.replace(ESRegexLib.TableBorderClass,'');if (D.length==0) A.attributes.removeNamedItem('class');else ESXHtml._AppendAttribute(A,'class',D);};ESXHtml._AppendChildNodes(A,B,false);return A;}
ESXHtml._GetMainXmlString=function(){var A=new XMLSerializer();return A.serializeToString(this.MainNode).replace(ESRegexLib.GeckoEntitiesMarker,'&');};ESXHtml._AppendEntity=function(A,B){A.appendChild(this.XML.createTextNode('#?-:'+B+';'));};ESXHtml._AppendAttributes=function(A,B,C){var D=B.attributes;for (var n=0;n<D.length;n++){var E=D[n];if (E.specified){var F=E.nodeName.toLowerCase();var G;if (F.startsWith('_es')) continue;else if (F.indexOf('_moz')==0) continue;else if (F=='class') G=E.nodeValue;else if (E.nodeValue===true) G=F;else G=B.getAttribute(F,2);if (ESConfig.ForceSimpleAmpersand&&G.replace) G=G.replace(/&/g,'___ESAmp___');this._AppendAttribute(C,F,G);};};}
var ESCodeFormatter;if (!(ESCodeFormatter=NS.ESCodeFormatter)){ESCodeFormatter=NS.ESCodeFormatter=new Object();ESCodeFormatter.Regex=new Object();ESCodeFormatter.Regex.BlocksOpener=/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;ESCodeFormatter.Regex.BlocksCloser=/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;ESCodeFormatter.Regex.NewLineTags=/\<(BR|HR)[^\>]\>/gi;ESCodeFormatter.Regex.MainTags=/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi;ESCodeFormatter.Regex.LineSplitter=/\s*\n+\s*/g;ESCodeFormatter.Regex.IncreaseIndent=/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \/\>]/i;ESCodeFormatter.Regex.DecreaseIndent=/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \>]/i;ESCodeFormatter.Regex.FormatIndentatorRemove=new RegExp(ESConfig.FormatIndentator);ESCodeFormatter.Regex.ProtectedTags=/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi;ESCodeFormatter._ProtectData=function(A,B,C,D){return B+'___ESpd___'+ESCodeFormatter.ProtectedData.addItem(C)+D;};ESCodeFormatter.Format=function(A){ESCodeFormatter.ProtectedData=new Array();var B=A.replace(this.Regex.ProtectedTags,ESCodeFormatter._ProtectData);B=B.replace(this.Regex.BlocksOpener,'\n$&');;B=B.replace(this.Regex.BlocksCloser,'$&\n');B=B.replace(this.Regex.NewLineTags,'$&\n');B=B.replace(this.Regex.MainTags,'\n$&\n');var C='';var D=B.split(this.Regex.LineSplitter);B='';for (var i=0;i<D.length;i++){var E=D[i];if (E.length==0) continue;if (this.Regex.DecreaseIndent.test(E)) C=C.replace(this.Regex.FormatIndentatorRemove,'');B+=C+E+'\n';if (this.Regex.IncreaseIndent.test(E)) C+=ESConfig.FormatIndentator;};for (var i=0;i<ESCodeFormatter.ProtectedData.length;i++){var F=new RegExp('___ESpd___'+i);B=B.replace(F,ESCodeFormatter.ProtectedData[i]);};return B.trim();};}
var ESUndo=new Object();ESUndo.SaveUndoStep=function(){}
var ES_StartupValue;ES.Events=new ESEvents(ES);ES.Toolbar=null;ES.TempBaseTag=ESConfig.BaseHref.length>0?'<base href="'+ESConfig.BaseHref+'" _estemp="true"></base>':'';ES.StartEditor=function(){this.EditorWindow=window.frames['eEditorArea'];this.EditorDocument=this.EditorWindow.document;this.SetHTML(ESTools.GetLinkedFieldValue());this.ResetIsDirty();ESTools.AttachToLinkedFieldFormSubmit(this.UpdateLinkedField);ESUndo.SaveUndoStep();this.SetStatus(ES_STATUS_ACTIVE);};function Window_OnFocus(){ES.Focus();ES.Events.FireEvent("OnFocus");};function Window_OnBlur(){if (!ESDialog.IsOpened) return ES.Events.FireEvent("OnBlur");};ES.SetStatus=function(A){this.Status=A;if (A==ES_STATUS_ACTIVE){window.frameElement.onfocus=window.document.body.onfocus=Window_OnFocus;window.frameElement.onblur=Window_OnBlur;if (ESConfig.StartupFocus) ES.Focus();if (ESBrowserInfo.IsIE) ESScriptLoader.AddScript('js/eseditorcode_ie_2.js');else ESScriptLoader.AddScript('js/eseditorcode_gecko_2.js');};this.Events.FireEvent('OnStatusChange',A);};ES.GetHTML=function(A){ES.GetXHTML(A);};ES.GetXHTML=function(A){var B=(ES.EditMode==ES_EDITMODE_SOURCE);if (B) this.SwitchEditMode();var C;if (ESConfig.FullPage) C=ESXHtml.GetXHTML(this.EditorDocument.getElementsByTagName('html')[0],true,A);else{if (ESConfig.IgnoreEmptyParagraphValue&&this.EditorDocument.body.innerHTML=='<P>&nbsp;</P>') C='';else C=ESXHtml.GetXHTML(this.EditorDocument.body,false,A);};if (B) this.SwitchEditMode();if (ESBrowserInfo.IsIE) C=C.replace(ESRegexLib.ToReplace,'$1');if (ES.DocTypeDeclaration&&ES.DocTypeDeclaration.length>0) C=ES.DocTypeDeclaration+'\n'+C;if (ES.XmlDeclaration&&ES.XmlDeclaration.length>0) C=ES.XmlDeclaration+'\n'+C;return ESConfig.ProtectedSource.Revert(C);};ES.UpdateLinkedField=function(){ES.LinkedField.value=ES.GetXHTML(ESConfig.FormatOutput);ES.Events.FireEvent('OnAfterLinkedFieldUpdate');};ES.ShowContextMenu=function(x,y){if (this.Status!=ES_STATUS_COMPLETE) return;ESContextMenu.Show(x,y);this.Events.FireEvent("OnContextMenu");};ES.RegisteredDoubleClickHandlers=new Object();ES.OnDoubleClick=function(A){var B=ES.RegisteredDoubleClickHandlers[A.tagName];if (B) B(A);};ES.RegisterDoubleClickHandler=function(A,B){ES.RegisteredDoubleClickHandlers[B.toUpperCase()]=A;};ES.OnAfterSetHTML=function(){var A,i=0;while((A=ESDocumentProcessors[i++])) A.ProcessDocument(ES.EditorDocument);this.Events.FireEvent('OnAfterSetHTML');};ES.ProtectUrls=function(A){A=A.replace(ESRegexLib.ProtectUrlsAApo,'$1$2$3$2 _essavedurl=$2$3$2');A=A.replace(ESRegexLib.ProtectUrlsANoApo,'$1$2 _essavedurl="$2"');A=A.replace(ESRegexLib.ProtectUrlsImgApo,'$1$2$3$2 _essavedurl=$2$3$2');A=A.replace(ESRegexLib.ProtectUrlsImgNoApo,'$1$2 _essavedurl="$2"');return A;};ES.IsDirty=function(){return (ES_StartupValue!=ES.EditorDocument.body.innerHTML);};ES.ResetIsDirty=function(){if (ES.EditorDocument.body) ES_StartupValue=ES.EditorDocument.body.innerHTML;};var ESDocumentProcessors=new Array();var ESDocumentProcessors_CreateFakeImage=function(A,B){var C=ES.EditorDocument.createElement('IMG');C.className=A;C.src=ESConfig.FullBasePath+'images/spacer.gif';C.setAttribute('_esfakelement','true',0);C.setAttribute('_esrealelement',ESTempBin.AddElement(B),0);return C;};var ESAnchorsProcessor=new Object();ESAnchorsProcessor.ProcessDocument=function(A){var B=A.getElementsByTagName('A');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){if (C.name.length>0&&(!C.getAttribute('href')||C.getAttribute('href').length==0)){var D=ESDocumentProcessors_CreateFakeImage('ES__Anchor',C.cloneNode(true));D.setAttribute('_esanchor','true',0);C.parentNode.insertBefore(D,C);C.parentNode.removeChild(C);};};};ESDocumentProcessors.addItem(ESAnchorsProcessor);var ESPageBreaksProcessor=new Object();ESPageBreaksProcessor.ProcessDocument=function(A){var B=A.getElementsByTagName('DIV');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){if (C.style.pageBreakAfter=='always'&&C.childNodes.length==1&&C.childNodes[0].style&&C.childNodes[0].style.display=='none'){var D=ESDocumentProcessors_CreateFakeImage('ES__PageBreak',C.cloneNode(true));C.parentNode.insertBefore(D,C);C.parentNode.removeChild(C);};};};ESDocumentProcessors.addItem(ESPageBreaksProcessor);var ESFlashProcessor=new Object();ESFlashProcessor.ProcessDocument=function(A){var B=A.getElementsByTagName('EMBED');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){if (C.src.endsWith('.swf',true)){var D=C.cloneNode(true);if (ESBrowserInfo.IsIE){D.setAttribute('scale',C.getAttribute('scale'));D.setAttribute('play',C.getAttribute('play'));D.setAttribute('loop',C.getAttribute('loop'));D.setAttribute('menu',C.getAttribute('menu'));};var E=ESDocumentProcessors_CreateFakeImage('ES__Flash',D);E.setAttribute('_esflash','true',0);ESFlashProcessor.RefreshView(E,C);C.parentNode.insertBefore(E,C);C.parentNode.removeChild(C);};};};ESFlashProcessor.RefreshView=function(A,B){if (B.width>0) A.style.width=ESTools.ConvertHtmlSizeToStyle(B.width);if (B.height>0) A.style.height=ESTools.ConvertHtmlSizeToStyle(B.height);};ESDocumentProcessors.addItem(ESFlashProcessor);ES.GetRealElement=function(A){var e=ESTempBin.Elements[A.getAttribute('_esrealelement')];if (A.getAttribute('_esflash')){if (A.style.width.length>0) e.width=ESTools.ConvertStyleSizeToHtml(A.style.width);if (A.style.height.length>0) e.height=ESTools.ConvertStyleSizeToHtml(A.style.height);};return e;};
ES.Description="ESeditor for Gecko Browsers";ES.InitializeBehaviors=function(){if (ESConfig.ShowBorders){var A=ESTools.AppendStyleSheet(this.EditorDocument,ESConfig.FullBasePath+'css/es_showtableborders_gecko.css');A.setAttribute('_estemp','true');};var B=function(e){e.preventDefault();ES.ShowContextMenu(e.clientX,e.clientY);};this.EditorDocument.addEventListener('contextmenu',B,true);var C=function(e){var D;if (e.ctrlKey&&!e.shiftKey&&!e.altKey){switch (e.which){case 66:case 98:ES.ExecuteNamedCommand('bold');D=true;break;case 105:case 73:ES.ExecuteNamedCommand('italic');D=true;break;case 117:case 85:ES.ExecuteNamedCommand('underline');D=true;break;case 86:case 118:D=(ES.Status!=ES_STATUS_COMPLETE||!ES.Events.FireEvent("OnPaste"));break;};}else if (e.shiftKey&&!e.ctrlKey&&!e.altKey&&e.keyCode==45) D=(ES.Status!=ES_STATUS_COMPLETE||!ES.Events.FireEvent("OnPaste"));if (D){e.preventDefault();e.stopPropagation();};};this.EditorDocument.addEventListener('keypress',C,true);this.ExecOnSelectionChange=function(){ES.Events.FireEvent("OnSelectionChange");};this.ExecOnSelectionChangeTimer=function(){if (ES.LastOnChangeTimer) window.clearTimeout(ES.LastOnChangeTimer);ES.LastOnChangeTimer=window.setTimeout(ES.ExecOnSelectionChange,100);};this.EditorDocument.addEventListener('mouseup',this.ExecOnSelectionChange,false);this.EditorDocument.addEventListener('keyup',this.ExecOnSelectionChangeTimer,false);this._DblClickListener=function(e){ES.OnDoubleClick(e.target);e.stopPropagation();};this.EditorDocument.addEventListener('dblclick',this._DblClickListener,true);this._OnLoad=function(){if (this._ES_HTML){this.document.body.innerHTML=this._ES_HTML;this._ES_HTML=null;if (!ES_StartupValue) ES.ResetIsDirty();};};this.EditorWindow.addEventListener('load',this._OnLoad,true);};ES.MakeEditable=function(){try{ES.EditorDocument.designMode='on';ES.EditorDocument.execCommand('useCSS',false,!ESConfig.GeckoUseSPAN);ES.EditorDocument.execCommand('enableObjectResizing',false,!ESConfig.DisableImageHandles);ES.EditorDocument.execCommand('enableInlineTableEditing',false,!ESConfig.DisableTableHandles);}catch (e) {};};ES.Focus=function(){try{ES.EditorWindow.focus();}catch(e) {};};ES.SetHTML=function(A,B){A=A.replace(ESRegexLib.StrongOpener,'<b$1');A=A.replace(ESRegexLib.StrongCloser,'<\/b>');A=A.replace(ESRegexLib.EmOpener,'<i$1');A=A.replace(ESRegexLib.EmCloser,'<\/i>');if (B||ES.EditMode==ES_EDITMODE_WYSIWYG){A=ESConfig.ProtectedSource.Protect(A);A=ES.ProtectUrls(A);if (ESConfig.FullPage&&ESRegexLib.BodyContents.test(A)){if (ES.TempBaseTag.length>0&&!ESRegexLib.HasBaseTag.test(A)) A=A.replace(ESRegexLib.HeadOpener,'$&'+ES.TempBaseTag);A=A.replace(ESRegexLib.HeadCloser,'<link href="'+ESConfig.BasePath+'css/es_internal.css'+'" rel="stylesheet" type="text/css" _estemp="true" /></head>');var C=A.match(ESRegexLib.BodyContents);var D=C[1];var E=C[2];var F=C[3];var G=D+'&nbsp;'+F;ES.MakeEditable();this.EditorDocument.open();this.EditorDocument.write(G);this.EditorDocument.close();if (this.EditorDocument.body) this.EditorDocument.body.innerHTML=E;else this.EditorWindow._ES_HTML=E;this.InitializeBehaviors();}else{if (!this._Initialized){this.EditorDocument.dir=ESConfig.ContentLangDirection;var G='<title></title>'+'<link href="'+ESConfig.EditorAreaCSS+'" rel="stylesheet" type="text/css" />'+'<link href="'+ESConfig.BasePath+'css/es_internal.css'+'" rel="stylesheet" type="text/css" _estemp="true" />'+ES.TempBaseTag;this.EditorDocument.getElementsByTagName("HEAD")[0].innerHTML=G;this.InitializeBehaviors();this._Initialized=true;};if (A.length==0) ES.EditorDocument.body.innerHTML=GECKO_BOGUS;else if (ESRegexLib.EmptyParagraph.test(A)) ES.EditorDocument.body.innerHTML=A.replace(ESRegexLib.TagBody,'>'+GECKO_BOGUS+'<');else ES.EditorDocument.body.innerHTML=A;ES.MakeEditable();};ES.OnAfterSetHTML();}else document.getElementById('eSourceField').value=A;};
